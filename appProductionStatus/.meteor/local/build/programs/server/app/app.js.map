{"version":3,"sources":["meteor://ðŸ’»app/imports/api/buildConfiguration.js","meteor://ðŸ’»app/imports/api/deployments.js","meteor://ðŸ’»app/server/main.js"],"names":["module","export","BuildConfiguration","AllowedUsers","Meteor","link","v","Mongo","Collection","isServer","publish","buildConfigurationPublication","user","userId","undefined","users","findOne","_id","username","ready","allow","insert","doc","update","fieldNames","modifier","remove","find","methods","Deployments","deploymentsPublication","deny","Picker","route","params","req","res","next","middleware","_getStableDeployment","_getStableDeploymentAppList","_getDeploymentEnvironments","rawdata","fields","fetch","data","map","a","deployment_environment","jsonData","JSON","stringify","setHeader","write","end","deployment","servers","apps","forEach","e","last_test_run","last_test_status","buildDate"],"mappings":"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","file":"/app.js","sourcesContent":["/*\n * Copyright (c) 2019. Colorado State University and Regents of the University of Colorado. All rights reserved.\n */\n\nimport {Meteor} from 'meteor/meteor';\nimport {Mongo} from 'meteor/mongo';\n\nexport const BuildConfiguration = new Mongo.Collection('buildConfiguration');\nexport const AllowedUsers = new Mongo.Collection('allowedUsers');\nif (Meteor.isServer) {\n    Meteor.publish('BuildConfiguration', function buildConfigurationPublication() {\n        var user = null;\n        if (this.userId !== undefined && Meteor.users.findOne({_id:this.userId}) !== undefined) {\n            user = Meteor.users.findOne({_id:this.userId}).username;\n        }\n        if (!user || !AllowedUsers.findOne({user:user})) {\n            return this.ready();\n        }\n        BuildConfiguration.allow({\n            insert: function (doc) {\n                return true;\n            },\n\n            update: function (doc, fieldNames, modifier) {\n                return true;\n            },\n\n            remove: function (doc) {\n                return true;\n            }\n        });\n        return BuildConfiguration.find({});\n    });\n}\n\nMeteor.methods({\n    // 'buildConfiguration.insert'(text) {\n    //   check(text, String);\n    //\n    //   BuildConfiguration.insert({\n    //     text,\n    //     createdAt: new Date(),\n    //     owner: this.userId,\n    //     username: Meteor.users.findOne(this.userId).username,\n    //   });\n    // }\n});\n","/*\n * Copyright (c) 2019. Colorado State University and Regents of the University of Colorado. All rights reserved.\n */\n\nimport {Meteor} from 'meteor/meteor';\nimport {Mongo} from 'meteor/mongo';\nexport const Deployments = new Mongo.Collection('deployment');\nif (Meteor.isServer) {\n    Meteor.publish('Deployments', function deploymentsPublication() {\n        Deployments.deny({\n            insert: function (doc) {\n                return true;\n            },\n            update: function (doc, fieldNames, modifier) {\n                return true;\n            },\n            remove: function (doc) {\n                return true;\n            }\n        });\n        return Deployments.find({});\n    });\n    // server side route for rest API\n    // define some server side routes\n    Picker.route('/:app/getStableDeployment/:deployment', function (params, req, res, next) {\n        Picker.middleware(_getStableDeployment(params, req, res, next));\n    });\n    Picker.route('/gsd/mats/:app/getStableDeployment/:deployment', function (params, req, res, next) {\n        Picker.middleware(_getStableDeployment(params, req, res, next));\n    });\n\n    Picker.route('/:app/getStableDeploymentAppList/:deployment', function (params, req, res, next) {\n        Picker.middleware(_getStableDeploymentAppList(params, req, res, next));\n    });\n    Picker.route('/gsd/mats/:app/getStableDeploymentAppList/:deployment', function (params, req, res, next) {\n        Picker.middleware(_getStableDeploymentAppList(params, req, res, next));\n    });\n\n    Picker.route('/:app/getDeploymentEnvironments', function (params, req, res, next) {\n        Picker.middleware(_getDeploymentEnvironments(params, req, res, next));\n    });\n    Picker.route('/gsd/mats/:app/getDeploymentEnvironments', function (params, req, res, next) {\n        Picker.middleware(_getDeploymentEnvironments(params, req, res, next));\n    });\n\n    // private middleware for _getDeploymentEnvironments route\n    const _getDeploymentEnvironments = function (params, req, res, next) {\n        var rawdata = Deployments.find({},{fields:{'deployment_environment':1,'_id':0}}).fetch();\n        var data = rawdata.map(a => a.deployment_environment);\n        var jsonData = JSON.stringify(data, null,2);\n        res.setHeader('Content-Type', 'application/json');\n        res.write(jsonData);\n        res.end();\n    }\n\n    // private middleware for _getProductionDeploymentAppsForServer route\n    const _getStableDeployment = function (params, req, res, next) {\n        var data = Deployments.findOne({deployment_environment: params.deployment},{\"apps.app\":1,\"apps.title\":1,\"apps.version\":1,_id:0});\n        if (data == null || data._id == null) {\n            data = {\"error\":\"cannot find such a deployment, try .../getStableDeploymentBundle/production\"};\n        }\n        delete data._id;\n        delete data.servers;\n        if (data.apps != null) {\n            data.apps.forEach(function(e){ delete e.last_test_run; delete e.last_test_status; delete e.buildDate;});\n        }\n        var jsonData = JSON.stringify(data, null,2);\n        res.setHeader('Content-Type', 'application/json');\n        res.write(jsonData);\n        res.end();\n    }\n    // private middleware for _getProductionDeploymentAppsForServer route\n    const _getStableDeploymentAppList = function (params, req, res, next) {\n        var data = Deployments.findOne({deployment_environment: params.deployment},{\"apps.app\":1,\"apps.title\":1,\"apps.version\":1,_id:0});\n        if (data == null || data._id == null) {\n            data = {\"error\":\"cannot find such a deployment, try .../getStableDeploymentBundle/production\"};\n        }\n        var jsonData = JSON.stringify(data.apps, [\"apps\",\"app\",\"title\",\"group\"],2);\n\n        res.setHeader('Content-Type', 'application/json');\n        res.write(jsonData);\n        res.end();\n    }\n\n}\nMeteor.methods({\n});\n","/*\n * Copyright (c) 2019. Colorado State University and Regents of the University of Colorado. All rights reserved.\n */\n\nimport '../imports/api/buildConfiguration.js';\nimport '../imports/api/deployments.js';\n"]}