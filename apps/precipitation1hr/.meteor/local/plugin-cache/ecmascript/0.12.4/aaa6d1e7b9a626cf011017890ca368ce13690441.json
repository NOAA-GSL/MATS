{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/route.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/ostrio:flow-router-extra/client/route.js","filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/route.js","passPerPreset":false,"envName":"development","cwd":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","root":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/route.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:flow-router-extra/client/route.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar Router;\nmodule.link(\"./_init.js\", {\n  Router: function (v) {\n    Router = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Promise;\nmodule.link(\"meteor/promise\", {\n  Promise: function (v) {\n    Promise = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\n\nvar _helpers;\n\nmodule.link(\"./../lib/_helpers.js\", {\n  _helpers: function (v) {\n    _helpers = v;\n  }\n}, 4);\nvar ReactiveDict;\nmodule.link(\"meteor/reactive-dict\", {\n  ReactiveDict: function (v) {\n    ReactiveDict = v;\n  }\n}, 5);\n\nvar makeTriggers = function (triggers) {\n  if (_helpers.isFunction(triggers)) {\n    return [triggers];\n  } else if (!_helpers.isArray(triggers)) {\n    return [];\n  }\n\n  return triggers;\n};\n\nvar Route =\n/*#__PURE__*/\nfunction () {\n  function Route() {\n    var router = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Router();\n    var pathDef = arguments.length > 1 ? arguments[1] : undefined;\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var group = arguments.length > 3 ? arguments[3] : undefined;\n    this.render = router.Renderer.render.bind(router.Renderer);\n    this.options = options;\n    this.globals = router.globals;\n    this.pathDef = pathDef; // Route.path is deprecated and will be removed in 3.0\n\n    this.path = pathDef;\n    this.conf = options.conf || {};\n    this.group = group;\n    this._data = options.data || null;\n    this._router = router;\n    this._action = options.action || Function.prototype;\n    this._waitOn = options.waitOn || null;\n    this._waitFor = _helpers.isArray(options.waitFor) ? options.waitFor : [];\n    this._subsMap = {};\n    this._onNoData = options.onNoData || null;\n    this._endWaiting = options.endWaiting || null;\n    this._currentData = null;\n    this._triggersExit = options.triggersExit ? makeTriggers(options.triggersExit) : [];\n    this._whileWaiting = options.whileWaiting || null;\n    this._triggersEnter = options.triggersEnter ? makeTriggers(options.triggersEnter) : [];\n    this._subscriptions = options.subscriptions || Function.prototype;\n    this._waitOnResources = options.waitOnResources || null;\n    this._params = new ReactiveDict();\n    this._queryParams = new ReactiveDict();\n    this._routeCloseDep = new Tracker.Dependency();\n    this._pathChangeDep = new Tracker.Dependency();\n\n    if (options.name) {\n      this.name = options.name;\n    }\n  }\n\n  var _proto = Route.prototype;\n\n  _proto.clearSubscriptions = function () {\n    function clearSubscriptions() {\n      this._subsMap = {};\n    }\n\n    return clearSubscriptions;\n  }();\n\n  _proto.register = function () {\n    function register(name, sub) {\n      this._subsMap[name] = sub;\n    }\n\n    return register;\n  }();\n\n  _proto.getSubscription = function () {\n    function getSubscription(name) {\n      return this._subsMap[name];\n    }\n\n    return getSubscription;\n  }();\n\n  _proto.getAllSubscriptions = function () {\n    function getAllSubscriptions() {\n      return this._subsMap;\n    }\n\n    return getAllSubscriptions;\n  }();\n\n  _proto.checkSubscriptions = function () {\n    function checkSubscriptions(subscriptions) {\n      var results = [];\n\n      for (var i = 0; i < subscriptions.length; i++) {\n        results.push(subscriptions[i] && subscriptions[i].ready ? subscriptions[i].ready() : false);\n      }\n\n      return !results.includes(false);\n    }\n\n    return checkSubscriptions;\n  }();\n\n  _proto.waitOn = function () {\n    function waitOn() {\n      var _this = this;\n\n      var current = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var next = arguments.length > 1 ? arguments[1] : undefined;\n      var _data = null;\n      var _isWaiting = false;\n      var _preloaded = 0;\n      var _resources = false;\n      var waitFor = [];\n      var promises = [];\n      var subscriptions = [];\n      var timer;\n      var trackers = [];\n\n      var placeIn = function (d) {\n        if (Object.prototype.toString.call(d) === '[object Promise]' || d.then && Object.prototype.toString.call(d.then) === '[object Function]') {\n          promises.push(d);\n        } else if (d.flush) {\n          trackers.push(d);\n        } else if (d.ready) {\n          subscriptions.push(d);\n        }\n      };\n\n      var whileWaitingAction = function () {\n        if (!_isWaiting) {\n          _this._whileWaiting && _this._whileWaiting(current.params, current.queryParams);\n          _isWaiting = true;\n        }\n      };\n\n      var subWait = function (delay) {\n        timer = Meteor.setTimeout(function () {\n          if (_this.checkSubscriptions(subscriptions)) {\n            Meteor.clearTimeout(timer);\n            _data = getData();\n\n            if (_resources) {\n              whileWaitingAction();\n              getResources();\n            } else {\n              next(current, _data);\n            }\n          } else {\n            wait(25);\n          }\n        }, delay);\n      };\n\n      var wait = function (delay) {\n        if (promises.length) {\n          Promise.all(promises).then(function () {\n            subWait(delay);\n            promises = [];\n          }).catch(function (error) {\n            Meteor._debug('[ostrio:flow-router-extra] [route.wait] Promise not resolved', error);\n          });\n        } else {\n          subWait(delay);\n        }\n      };\n\n      var processSubData = function (subData) {\n        if (subData instanceof Array) {\n          for (var i = subData.length - 1; i >= 0; i--) {\n            if (subData[i] !== null && (0, _typeof2.default)(subData[i]) === 'object') {\n              placeIn(subData[i]);\n            }\n          }\n        } else if (subData !== null && (0, _typeof2.default)(subData) === 'object') {\n          placeIn(subData);\n        }\n      };\n\n      var stopSubs = function () {\n        for (var i = subscriptions.length - 1; i >= 0; i--) {\n          if (subscriptions[i].stop) {\n            subscriptions[i].stop();\n          }\n\n          delete subscriptions[i];\n        }\n\n        subscriptions = [];\n      };\n\n      var done = function (subscription) {\n        processSubData(_helpers.isFunction(subscription) ? subscription() : subscription);\n      };\n\n      if (current.route.globals.length) {\n        for (var i = 0; i < current.route.globals.length; i++) {\n          if ((0, _typeof2.default)(current.route.globals[i]) === 'object') {\n            if (current.route.globals[i].waitOnResources) {\n              if (!_resources) {\n                _resources = [];\n              }\n\n              _resources.push(current.route.globals[i].waitOnResources);\n            }\n\n            if (current.route.globals[i].waitOn && _helpers.isFunction(current.route.globals[i].waitOn)) {\n              waitFor.unshift(current.route.globals[i].waitOn);\n            }\n          }\n        }\n      }\n\n      if (this._waitOnResources) {\n        if (!_resources) {\n          _resources = [];\n        }\n\n        _resources.push(this._waitOnResources);\n      }\n\n      var preload = function (len, __data) {\n        _preloaded++;\n\n        if (_preloaded >= len) {\n          next(current, __data);\n        }\n      };\n\n      var getData = function () {\n        if (_this._data) {\n          if (!_data) {\n            _data = _this._currentData = _this._data(current.params, current.queryParams);\n          } else {\n            _data = _this._currentData;\n          }\n        }\n\n        return _data;\n      };\n\n      var getResources = function () {\n        _data = getData();\n        var len = 0;\n        var items;\n        var images = [];\n        var other = [];\n\n        for (var _i = _resources.length - 1; _i >= 0; _i--) {\n          items = _resources[_i].call(_this, current.params, current.queryParams, _data);\n\n          if (items) {\n            if (items.images && items.images.length) {\n              images = images.concat(items.images);\n            }\n\n            if (items.other && items.other.length) {\n              other = other.concat(items.other);\n            }\n          }\n        }\n\n        if (other && other.length || images && images.length) {\n          if (other && other.length && typeof XMLHttpRequest !== 'undefined') {\n            other = other.filter(function (elem, index, self) {\n              return index === self.indexOf(elem);\n            });\n            len += other.length;\n            var prefetch = {};\n\n            for (var k = other.length - 1; k >= 0; k--) {\n              prefetch[k] = new XMLHttpRequest();\n\n              prefetch[k].onload = function () {\n                preload(len, _data);\n              };\n\n              prefetch[k].onerror = function () {\n                preload(len, _data);\n              };\n\n              prefetch[k].open('GET', other[k]);\n              prefetch[k].send(null);\n            }\n          }\n\n          if (images && images.length) {\n            images = images.filter(function (elem, index, self) {\n              return index === self.indexOf(elem);\n            });\n            len += images.length;\n            var imgs = {};\n\n            for (var j = images.length - 1; j >= 0; j--) {\n              imgs[j] = new Image();\n\n              imgs[j].onload = function () {\n                preload(len, _data);\n              };\n\n              imgs[j].onerror = function () {\n                preload(len, _data);\n              };\n\n              imgs[j].src = images[j];\n            }\n          }\n        } else {\n          next(current, _data);\n        }\n      };\n\n      if (this._waitFor.length) {\n        waitFor = waitFor.concat(this._waitFor);\n      }\n\n      if (_helpers.isFunction(this._waitOn)) {\n        waitFor.push(this._waitOn);\n      }\n\n      if (waitFor.length) {\n        waitFor.forEach(function (wo) {\n          processSubData(wo.call(_this, current.params, current.queryParams, done));\n        });\n\n        var triggerExitIndex = this._triggersExit.push(function () {\n          stopSubs();\n\n          for (var _i2 = trackers.length - 1; _i2 >= 0; _i2--) {\n            if (trackers[_i2].stop) {\n              trackers[_i2].stop();\n            }\n\n            delete trackers[_i2];\n          }\n\n          trackers = [];\n          promises = [];\n          subscriptions = [];\n          _data = _this._currentData = null;\n\n          _this._triggersExit.splice(triggerExitIndex - 1, 1);\n        });\n\n        whileWaitingAction();\n        wait(0);\n      } else if (_resources) {\n        whileWaitingAction();\n        getResources();\n      } else if (this._data) {\n        next(current, getData());\n      } else {\n        next(current);\n      }\n    }\n\n    return waitOn;\n  }();\n\n  _proto.callAction = function () {\n    function callAction(current) {\n      if (this._data) {\n        if (this._onNoData && !this._currentData) {\n          this._endWaiting && this._endWaiting();\n\n          this._onNoData(current.params, current.queryParams);\n        } else {\n          this._endWaiting && this._endWaiting();\n\n          this._action(current.params, current.queryParams, this._currentData);\n        }\n      } else {\n        this._endWaiting && this._endWaiting();\n\n        this._action(current.params, current.queryParams, this._currentData);\n      }\n    }\n\n    return callAction;\n  }();\n\n  _proto.callSubscriptions = function () {\n    function callSubscriptions(current) {\n      this.clearSubscriptions();\n\n      if (this.group) {\n        this.group.callSubscriptions(current);\n      }\n\n      this._subscriptions(current.params, current.queryParams);\n    }\n\n    return callSubscriptions;\n  }();\n\n  _proto.getRouteName = function () {\n    function getRouteName() {\n      this._routeCloseDep.depend();\n\n      return this.name;\n    }\n\n    return getRouteName;\n  }();\n\n  _proto.getParam = function () {\n    function getParam(key) {\n      this._routeCloseDep.depend();\n\n      return this._params.get(key);\n    }\n\n    return getParam;\n  }();\n\n  _proto.getQueryParam = function () {\n    function getQueryParam(key) {\n      this._routeCloseDep.depend();\n\n      return this._queryParams.get(key);\n    }\n\n    return getQueryParam;\n  }();\n\n  _proto.watchPathChange = function () {\n    function watchPathChange() {\n      this._pathChangeDep.depend();\n    }\n\n    return watchPathChange;\n  }();\n\n  _proto.registerRouteClose = function () {\n    function registerRouteClose() {\n      this._params = new ReactiveDict();\n      this._queryParams = new ReactiveDict();\n\n      this._routeCloseDep.changed();\n\n      this._pathChangeDep.changed();\n    }\n\n    return registerRouteClose;\n  }();\n\n  _proto.registerRouteChange = function () {\n    function registerRouteChange(currentContext, routeChanging) {\n      // register params\n      this._updateReactiveDict(this._params, currentContext.params); // register query params\n\n\n      this._updateReactiveDict(this._queryParams, currentContext.queryParams); // if the route is changing, we need to defer triggering path changing\n      // if we did this, old route's path watchers will detect this\n      // Real issue is, above watcher will get removed with the new route\n      // So, we don't need to trigger it now\n      // We are doing it on the route close event. So, if they exists they'll\n      // get notify that\n\n\n      if (!routeChanging) {\n        this._pathChangeDep.changed();\n      }\n    }\n\n    return registerRouteChange;\n  }();\n\n  _proto._updateReactiveDict = function () {\n    function _updateReactiveDict(dict, newValues) {\n      var currentKeys = Object.keys(newValues);\n      var oldKeys = Object.keys(dict.keyDeps); // set new values\n      //  params is an array. So, currentKeys.forEach() does not works\n      //  to iterate params\n\n      currentKeys.forEach(function (key) {\n        dict.set(key, newValues[key]);\n      }); // remove keys which does not exisits here\n\n      oldKeys.filter(function (i) {\n        return currentKeys.indexOf(i) < 0;\n      }).forEach(function (key) {\n        dict.set(key, undefined);\n      });\n    }\n\n    return _updateReactiveDict;\n  }();\n\n  return Route;\n}();\n\nmodule.exportDefault(Route);","map":{"version":3,"sources":["packages/ostrio:flow-router-extra/client/route.js"],"names":["Router","module","link","v","Meteor","Promise","Tracker","_helpers","ReactiveDict","makeTriggers","triggers","isFunction","isArray","Route","router","pathDef","options","group","render","Renderer","bind","globals","path","conf","_data","data","_router","_action","action","Function","prototype","_waitOn","waitOn","_waitFor","waitFor","_subsMap","_onNoData","onNoData","_endWaiting","endWaiting","_currentData","_triggersExit","triggersExit","_whileWaiting","whileWaiting","_triggersEnter","triggersEnter","_subscriptions","subscriptions","_waitOnResources","waitOnResources","_params","_queryParams","_routeCloseDep","Dependency","_pathChangeDep","name","clearSubscriptions","register","sub","getSubscription","getAllSubscriptions","checkSubscriptions","results","i","length","push","ready","includes","current","next","_isWaiting","_preloaded","_resources","promises","timer","trackers","placeIn","d","Object","toString","call","then","flush","whileWaitingAction","params","queryParams","subWait","delay","setTimeout","clearTimeout","getData","getResources","wait","all","catch","error","_debug","processSubData","subData","Array","stopSubs","stop","done","subscription","route","unshift","preload","len","__data","items","images","other","concat","XMLHttpRequest","filter","elem","index","self","indexOf","prefetch","k","onload","onerror","open","send","imgs","j","Image","src","forEach","wo","triggerExitIndex","splice","callAction","callSubscriptions","getRouteName","depend","getParam","key","get","getQueryParam","watchPathChange","registerRouteClose","changed","registerRouteChange","currentContext","routeChanging","_updateReactiveDict","dict","newValues","currentKeys","keys","oldKeys","keyDeps","set","undefined","exportDefault"],"mappings":";;;;AAAA,IAAIA,MAAJ;AAAWC,MAAM,CAACC,IAAP,CAAY,YAAZ,EAAyB;AAACF,EAAAA,MAAD,YAAQG,CAAR,EAAU;AAACH,IAAAA,MAAM,GAACG,CAAP;AAAS;AAApB,CAAzB,EAA+C,CAA/C;AAAkD,IAAIC,MAAJ;AAAWH,MAAM,CAACC,IAAP,CAAY,eAAZ,EAA4B;AAACE,EAAAA,MAAD,YAAQD,CAAR,EAAU;AAACC,IAAAA,MAAM,GAACD,CAAP;AAAS;AAApB,CAA5B,EAAkD,CAAlD;AAAqD,IAAIE,OAAJ;AAAYJ,MAAM,CAACC,IAAP,CAAY,gBAAZ,EAA6B;AAACG,EAAAA,OAAD,YAASF,CAAT,EAAW;AAACE,IAAAA,OAAO,GAACF,CAAR;AAAU;AAAtB,CAA7B,EAAqD,CAArD;AAAwD,IAAIG,OAAJ;AAAYL,MAAM,CAACC,IAAP,CAAY,gBAAZ,EAA6B;AAACI,EAAAA,OAAD,YAASH,CAAT,EAAW;AAACG,IAAAA,OAAO,GAACH,CAAR;AAAU;AAAtB,CAA7B,EAAqD,CAArD;;AAAwD,IAAII,QAAJ;;AAAaN,MAAM,CAACC,IAAP,CAAY,sBAAZ,EAAmC;AAACK,EAAAA,QAAD,YAAUJ,CAAV,EAAY;AAACI,IAAAA,QAAQ,GAACJ,CAAT;AAAW;AAAxB,CAAnC,EAA6D,CAA7D;AAAgE,IAAIK,YAAJ;AAAiBP,MAAM,CAACC,IAAP,CAAY,sBAAZ,EAAmC;AAACM,EAAAA,YAAD,YAAcL,CAAd,EAAgB;AAACK,IAAAA,YAAY,GAACL,CAAb;AAAe;AAAhC,CAAnC,EAAqE,CAArE;;AAOnW,IAAMM,YAAY,GAAG,UAACC,QAAD,EAAc;AACjC,MAAIH,QAAQ,CAACI,UAAT,CAAoBD,QAApB,CAAJ,EAAmC;AACjC,WAAO,CAACA,QAAD,CAAP;AACD,GAFD,MAEO,IAAI,CAACH,QAAQ,CAACK,OAAT,CAAiBF,QAAjB,CAAL,EAAiC;AACtC,WAAO,EAAP;AACD;;AAED,SAAOA,QAAP;AACD,CARD;;IAUMG,K;;;AACJ,mBAAiE;AAAA,QAArDC,MAAqD,uEAA5C,IAAId,MAAJ,EAA4C;AAAA,QAA9Be,OAA8B;AAAA,QAArBC,OAAqB,uEAAX,EAAW;AAAA,QAAPC,KAAO;AAC/D,SAAKC,MAAL,GAAwBJ,MAAM,CAACK,QAAP,CAAgBD,MAAhB,CAAuBE,IAAvB,CAA4BN,MAAM,CAACK,QAAnC,CAAxB;AACA,SAAKH,OAAL,GAAwBA,OAAxB;AACA,SAAKK,OAAL,GAAwBP,MAAM,CAACO,OAA/B;AACA,SAAKN,OAAL,GAAwBA,OAAxB,CAJ+D,CAM/D;;AACA,SAAKO,IAAL,GAAwBP,OAAxB;AACA,SAAKQ,IAAL,GAAwBP,OAAO,CAACO,IAAR,IAAgB,EAAxC;AACA,SAAKN,KAAL,GAAwBA,KAAxB;AACA,SAAKO,KAAL,GAAwBR,OAAO,CAACS,IAAR,IAAgB,IAAxC;AACA,SAAKC,OAAL,GAAwBZ,MAAxB;AACA,SAAKa,OAAL,GAAwBX,OAAO,CAACY,MAAR,IAAkBC,QAAQ,CAACC,SAAnD;AACA,SAAKC,OAAL,GAAwBf,OAAO,CAACgB,MAAR,IAAkB,IAA1C;AACA,SAAKC,QAAL,GAAwB1B,QAAQ,CAACK,OAAT,CAAiBI,OAAO,CAACkB,OAAzB,IAAoClB,OAAO,CAACkB,OAA5C,GAAsD,EAA9E;AACA,SAAKC,QAAL,GAAwB,EAAxB;AACA,SAAKC,SAAL,GAAwBpB,OAAO,CAACqB,QAAR,IAAoB,IAA5C;AACA,SAAKC,WAAL,GAAwBtB,OAAO,CAACuB,UAAR,IAAsB,IAA9C;AACA,SAAKC,YAAL,GAAwB,IAAxB;AACA,SAAKC,aAAL,GAAwBzB,OAAO,CAAC0B,YAAR,GAAuBjC,YAAY,CAACO,OAAO,CAAC0B,YAAT,CAAnC,GAA4D,EAApF;AACA,SAAKC,aAAL,GAAwB3B,OAAO,CAAC4B,YAAR,IAAwB,IAAhD;AACA,SAAKC,cAAL,GAAwB7B,OAAO,CAAC8B,aAAR,GAAwBrC,YAAY,CAACO,OAAO,CAAC8B,aAAT,CAApC,GAA8D,EAAtF;AACA,SAAKC,cAAL,GAAwB/B,OAAO,CAACgC,aAAR,IAAyBnB,QAAQ,CAACC,SAA1D;AACA,SAAKmB,gBAAL,GAAwBjC,OAAO,CAACkC,eAAR,IAA2B,IAAnD;AAEA,SAAKC,OAAL,GAAwB,IAAI3C,YAAJ,EAAxB;AACA,SAAK4C,YAAL,GAAwB,IAAI5C,YAAJ,EAAxB;AACA,SAAK6C,cAAL,GAAwB,IAAI/C,OAAO,CAACgD,UAAZ,EAAxB;AACA,SAAKC,cAAL,GAAwB,IAAIjD,OAAO,CAACgD,UAAZ,EAAxB;;AAEA,QAAItC,OAAO,CAACwC,IAAZ,EAAkB;AAChB,WAAKA,IAAL,GAAYxC,OAAO,CAACwC,IAApB;AACD;AACF;;;;SAEDC,kB;kCAAqB;AACnB,WAAKtB,QAAL,GAAgB,EAAhB;AACD;;;;;SAEDuB,Q;sBAASF,I,EAAMG,G,EAAK;AAClB,WAAKxB,QAAL,CAAcqB,IAAd,IAAsBG,GAAtB;AACD;;;;;SAEDC,e;6BAAgBJ,I,EAAM;AACpB,aAAO,KAAKrB,QAAL,CAAcqB,IAAd,CAAP;AACD;;;;;SAEDK,mB;mCAAsB;AACpB,aAAO,KAAK1B,QAAZ;AACD;;;;;SAED2B,kB;gCAAmBd,a,EAAe;AAChC,UAAMe,OAAO,GAAG,EAAhB;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGhB,aAAa,CAACiB,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7CD,QAAAA,OAAO,CAACG,IAAR,CAAclB,aAAa,CAACgB,CAAD,CAAb,IAAoBhB,aAAa,CAACgB,CAAD,CAAb,CAAiBG,KAAtC,GAA+CnB,aAAa,CAACgB,CAAD,CAAb,CAAiBG,KAAjB,EAA/C,GAA0E,KAAvF;AACD;;AAED,aAAO,CAACJ,OAAO,CAACK,QAAR,CAAiB,KAAjB,CAAR;AACD;;;;;SAEDpC,M;sBAA2B;AAAA;;AAAA,UAApBqC,OAAoB,uEAAV,EAAU;AAAA,UAANC,IAAM;AACzB,UAAI9C,KAAK,GAAW,IAApB;AACA,UAAI+C,UAAU,GAAM,KAApB;AACA,UAAIC,UAAU,GAAM,CAApB;AACA,UAAIC,UAAU,GAAM,KAApB;AACA,UAAIvC,OAAO,GAAS,EAApB;AACA,UAAIwC,QAAQ,GAAQ,EAApB;AACA,UAAI1B,aAAa,GAAG,EAApB;AACA,UAAI2B,KAAJ;AACA,UAAIC,QAAQ,GAAQ,EAApB;;AAEA,UAAMC,OAAO,GAAG,UAACC,CAAD,EAAO;AACrB,YAAIC,MAAM,CAACjD,SAAP,CAAiBkD,QAAjB,CAA0BC,IAA1B,CAA+BH,CAA/B,MAAsC,kBAAtC,IAA4DA,CAAC,CAACI,IAAF,IAAUH,MAAM,CAACjD,SAAP,CAAiBkD,QAAjB,CAA0BC,IAA1B,CAA+BH,CAAC,CAACI,IAAjC,MAA2C,mBAArH,EAA0I;AACxIR,UAAAA,QAAQ,CAACR,IAAT,CAAcY,CAAd;AACD,SAFD,MAEO,IAAIA,CAAC,CAACK,KAAN,EAAa;AAClBP,UAAAA,QAAQ,CAACV,IAAT,CAAcY,CAAd;AACD,SAFM,MAEA,IAAIA,CAAC,CAACX,KAAN,EAAa;AAClBnB,UAAAA,aAAa,CAACkB,IAAd,CAAmBY,CAAnB;AACD;AACF,OARD;;AAUA,UAAMM,kBAAkB,GAAG,YAAM;AAC/B,YAAI,CAACb,UAAL,EAAiB;AACf,UAAA,KAAI,CAAC5B,aAAL,IAAsB,KAAI,CAACA,aAAL,CAAmB0B,OAAO,CAACgB,MAA3B,EAAmChB,OAAO,CAACiB,WAA3C,CAAtB;AACAf,UAAAA,UAAU,GAAG,IAAb;AACD;AACF,OALD;;AAOA,UAAMgB,OAAO,GAAG,UAACC,KAAD,EAAW;AACzBb,QAAAA,KAAK,GAAGvE,MAAM,CAACqF,UAAP,CAAkB,YAAM;AAC9B,cAAI,KAAI,CAAC3B,kBAAL,CAAwBd,aAAxB,CAAJ,EAA4C;AAC1C5C,YAAAA,MAAM,CAACsF,YAAP,CAAoBf,KAApB;AACAnD,YAAAA,KAAK,GAAGmE,OAAO,EAAf;;AACA,gBAAIlB,UAAJ,EAAgB;AACdW,cAAAA,kBAAkB;AAClBQ,cAAAA,YAAY;AACb,aAHD,MAGO;AACLtB,cAAAA,IAAI,CAACD,OAAD,EAAU7C,KAAV,CAAJ;AACD;AACF,WATD,MASO;AACLqE,YAAAA,IAAI,CAAC,EAAD,CAAJ;AACD;AACF,SAbO,EAaLL,KAbK,CAAR;AAcD,OAfD;;AAiBA,UAAMK,IAAI,GAAG,UAACL,KAAD,EAAW;AACtB,YAAId,QAAQ,CAACT,MAAb,EAAqB;AACnB5D,UAAAA,OAAO,CAACyF,GAAR,CAAYpB,QAAZ,EAAsBQ,IAAtB,CAA2B,YAAM;AAC/BK,YAAAA,OAAO,CAACC,KAAD,CAAP;AACAd,YAAAA,QAAQ,GAAG,EAAX;AACD,WAHD,EAGGqB,KAHH,CAGS,UAACC,KAAD,EAAW;AAClB5F,YAAAA,MAAM,CAAC6F,MAAP,CAAc,8DAAd,EAA8ED,KAA9E;AACD,WALD;AAMD,SAPD,MAOO;AACLT,UAAAA,OAAO,CAACC,KAAD,CAAP;AACD;AACF,OAXD;;AAaA,UAAMU,cAAc,GAAG,UAACC,OAAD,EAAa;AAClC,YAAIA,OAAO,YAAYC,KAAvB,EAA8B;AAC5B,eAAK,IAAIpC,CAAC,GAAGmC,OAAO,CAAClC,MAAR,GAAiB,CAA9B,EAAiCD,CAAC,IAAI,CAAtC,EAAyCA,CAAC,EAA1C,EAA8C;AAC5C,gBAAImC,OAAO,CAACnC,CAAD,CAAP,KAAe,IAAf,IAAuB,sBAAOmC,OAAO,CAACnC,CAAD,CAAd,MAAsB,QAAjD,EAA2D;AACzDa,cAAAA,OAAO,CAACsB,OAAO,CAACnC,CAAD,CAAR,CAAP;AACD;AACF;AACF,SAND,MAMO,IAAImC,OAAO,KAAK,IAAZ,IAAoB,sBAAOA,OAAP,MAAmB,QAA3C,EAAqD;AAC1DtB,UAAAA,OAAO,CAACsB,OAAD,CAAP;AACD;AACF,OAVD;;AAYA,UAAME,QAAQ,GAAG,YAAM;AACrB,aAAK,IAAIrC,CAAC,GAAGhB,aAAa,CAACiB,MAAd,GAAuB,CAApC,EAAuCD,CAAC,IAAI,CAA5C,EAA+CA,CAAC,EAAhD,EAAoD;AAClD,cAAIhB,aAAa,CAACgB,CAAD,CAAb,CAAiBsC,IAArB,EAA2B;AACzBtD,YAAAA,aAAa,CAACgB,CAAD,CAAb,CAAiBsC,IAAjB;AACD;;AACD,iBAAOtD,aAAa,CAACgB,CAAD,CAApB;AACD;;AACDhB,QAAAA,aAAa,GAAG,EAAhB;AACD,OARD;;AAUA,UAAMuD,IAAI,GAAG,UAACC,YAAD,EAAkB;AAC7BN,QAAAA,cAAc,CAAC3F,QAAQ,CAACI,UAAT,CAAoB6F,YAApB,IAAoCA,YAAY,EAAhD,GAAqDA,YAAtD,CAAd;AACD,OAFD;;AAIA,UAAInC,OAAO,CAACoC,KAAR,CAAcpF,OAAd,CAAsB4C,MAA1B,EAAkC;AAChC,aAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGK,OAAO,CAACoC,KAAR,CAAcpF,OAAd,CAAsB4C,MAA1C,EAAkDD,CAAC,EAAnD,EAAuD;AACrD,cAAI,sBAAOK,OAAO,CAACoC,KAAR,CAAcpF,OAAd,CAAsB2C,CAAtB,CAAP,MAAoC,QAAxC,EAAkD;AAChD,gBAAIK,OAAO,CAACoC,KAAR,CAAcpF,OAAd,CAAsB2C,CAAtB,EAAyBd,eAA7B,EAA8C;AAC5C,kBAAI,CAACuB,UAAL,EAAiB;AAAEA,gBAAAA,UAAU,GAAG,EAAb;AAAkB;;AACrCA,cAAAA,UAAU,CAACP,IAAX,CAAgBG,OAAO,CAACoC,KAAR,CAAcpF,OAAd,CAAsB2C,CAAtB,EAAyBd,eAAzC;AACD;;AAED,gBAAImB,OAAO,CAACoC,KAAR,CAAcpF,OAAd,CAAsB2C,CAAtB,EAAyBhC,MAAzB,IAAmCzB,QAAQ,CAACI,UAAT,CAAoB0D,OAAO,CAACoC,KAAR,CAAcpF,OAAd,CAAsB2C,CAAtB,EAAyBhC,MAA7C,CAAvC,EAA6F;AAC3FE,cAAAA,OAAO,CAACwE,OAAR,CAAgBrC,OAAO,CAACoC,KAAR,CAAcpF,OAAd,CAAsB2C,CAAtB,EAAyBhC,MAAzC;AACD;AACF;AACF;AACF;;AAED,UAAI,KAAKiB,gBAAT,EAA2B;AACzB,YAAI,CAACwB,UAAL,EAAiB;AAAEA,UAAAA,UAAU,GAAG,EAAb;AAAkB;;AACrCA,QAAAA,UAAU,CAACP,IAAX,CAAgB,KAAKjB,gBAArB;AACD;;AAED,UAAM0D,OAAO,GAAG,UAACC,GAAD,EAAMC,MAAN,EAAiB;AAC/BrC,QAAAA,UAAU;;AACV,YAAIA,UAAU,IAAIoC,GAAlB,EAAuB;AACrBtC,UAAAA,IAAI,CAACD,OAAD,EAAUwC,MAAV,CAAJ;AACD;AACF,OALD;;AAOA,UAAMlB,OAAO,GAAG,YAAM;AACpB,YAAI,KAAI,CAACnE,KAAT,EAAgB;AACd,cAAI,CAACA,KAAL,EAAY;AACVA,YAAAA,KAAK,GAAG,KAAI,CAACgB,YAAL,GAAoB,KAAI,CAAChB,KAAL,CAAW6C,OAAO,CAACgB,MAAnB,EAA2BhB,OAAO,CAACiB,WAAnC,CAA5B;AACD,WAFD,MAEO;AACL9D,YAAAA,KAAK,GAAG,KAAI,CAACgB,YAAb;AACD;AACF;;AACD,eAAOhB,KAAP;AACD,OATD;;AAWA,UAAMoE,YAAY,GAAG,YAAM;AACzBpE,QAAAA,KAAK,GAAQmE,OAAO,EAApB;AACA,YAAIiB,GAAG,GAAM,CAAb;AACA,YAAIE,KAAJ;AACA,YAAIC,MAAM,GAAG,EAAb;AACA,YAAIC,KAAK,GAAI,EAAb;;AACA,aAAK,IAAIhD,EAAC,GAAGS,UAAU,CAACR,MAAX,GAAoB,CAAjC,EAAoCD,EAAC,IAAI,CAAzC,EAA4CA,EAAC,EAA7C,EAAiD;AAC/C8C,UAAAA,KAAK,GAAGrC,UAAU,CAACT,EAAD,CAAV,CAAciB,IAAd,CAAmB,KAAnB,EAAyBZ,OAAO,CAACgB,MAAjC,EAAyChB,OAAO,CAACiB,WAAjD,EAA8D9D,KAA9D,CAAR;;AACA,cAAIsF,KAAJ,EAAW;AACT,gBAAIA,KAAK,CAACC,MAAN,IAAgBD,KAAK,CAACC,MAAN,CAAa9C,MAAjC,EAAyC;AACvC8C,cAAAA,MAAM,GAAGA,MAAM,CAACE,MAAP,CAAcH,KAAK,CAACC,MAApB,CAAT;AACD;;AACD,gBAAID,KAAK,CAACE,KAAN,IAAeF,KAAK,CAACE,KAAN,CAAY/C,MAA/B,EAAuC;AACrC+C,cAAAA,KAAK,GAAGA,KAAK,CAACC,MAAN,CAAaH,KAAK,CAACE,KAAnB,CAAR;AACD;AACF;AACF;;AAED,YAAKA,KAAK,IAAIA,KAAK,CAAC/C,MAAhB,IAA4B8C,MAAM,IAAIA,MAAM,CAAC9C,MAAjD,EAA0D;AACxD,cAAI+C,KAAK,IAAIA,KAAK,CAAC/C,MAAf,IAAyB,OAAOiD,cAAP,KAA0B,WAAvD,EAAoE;AAClEF,YAAAA,KAAK,GAAGA,KAAK,CAACG,MAAN,CAAa,UAACC,IAAD,EAAOC,KAAP,EAAcC,IAAd,EAAuB;AAC1C,qBAAOD,KAAK,KAAKC,IAAI,CAACC,OAAL,CAAaH,IAAb,CAAjB;AACD,aAFO,CAAR;AAGAR,YAAAA,GAAG,IAAII,KAAK,CAAC/C,MAAb;AACA,gBAAMuD,QAAQ,GAAG,EAAjB;;AACA,iBAAK,IAAIC,CAAC,GAAGT,KAAK,CAAC/C,MAAN,GAAe,CAA5B,EAA+BwD,CAAC,IAAI,CAApC,EAAuCA,CAAC,EAAxC,EAA4C;AAC1CD,cAAAA,QAAQ,CAACC,CAAD,CAAR,GAAc,IAAIP,cAAJ,EAAd;;AACAM,cAAAA,QAAQ,CAACC,CAAD,CAAR,CAAYC,MAAZ,GAAsB,YAAM;AAAEf,gBAAAA,OAAO,CAACC,GAAD,EAAMpF,KAAN,CAAP;AAAsB,eAApD;;AACAgG,cAAAA,QAAQ,CAACC,CAAD,CAAR,CAAYE,OAAZ,GAAsB,YAAM;AAAEhB,gBAAAA,OAAO,CAACC,GAAD,EAAMpF,KAAN,CAAP;AAAsB,eAApD;;AACAgG,cAAAA,QAAQ,CAACC,CAAD,CAAR,CAAYG,IAAZ,CAAiB,KAAjB,EAAwBZ,KAAK,CAACS,CAAD,CAA7B;AACAD,cAAAA,QAAQ,CAACC,CAAD,CAAR,CAAYI,IAAZ,CAAiB,IAAjB;AACD;AACF;;AAED,cAAId,MAAM,IAAIA,MAAM,CAAC9C,MAArB,EAA4B;AAC1B8C,YAAAA,MAAM,GAAGA,MAAM,CAACI,MAAP,CAAc,UAACC,IAAD,EAAOC,KAAP,EAAcC,IAAd,EAAuB;AAC5C,qBAAOD,KAAK,KAAKC,IAAI,CAACC,OAAL,CAAaH,IAAb,CAAjB;AACD,aAFQ,CAAT;AAGAR,YAAAA,GAAG,IAAIG,MAAM,CAAC9C,MAAd;AACA,gBAAM6D,IAAI,GAAG,EAAb;;AACA,iBAAK,IAAIC,CAAC,GAAGhB,MAAM,CAAC9C,MAAP,GAAgB,CAA7B,EAAgC8D,CAAC,IAAI,CAArC,EAAwCA,CAAC,EAAzC,EAA6C;AAC3CD,cAAAA,IAAI,CAACC,CAAD,CAAJ,GAAkB,IAAIC,KAAJ,EAAlB;;AACAF,cAAAA,IAAI,CAACC,CAAD,CAAJ,CAAQL,MAAR,GAAkB,YAAM;AAAEf,gBAAAA,OAAO,CAACC,GAAD,EAAMpF,KAAN,CAAP;AAAsB,eAAhD;;AACAsG,cAAAA,IAAI,CAACC,CAAD,CAAJ,CAAQJ,OAAR,GAAkB,YAAM;AAAEhB,gBAAAA,OAAO,CAACC,GAAD,EAAMpF,KAAN,CAAP;AAAsB,eAAhD;;AACAsG,cAAAA,IAAI,CAACC,CAAD,CAAJ,CAAQE,GAAR,GAAkBlB,MAAM,CAACgB,CAAD,CAAxB;AACD;AACF;AACF,SA7BD,MA6BO;AACLzD,UAAAA,IAAI,CAACD,OAAD,EAAU7C,KAAV,CAAJ;AACD;AACF,OAlDD;;AAoDA,UAAI,KAAKS,QAAL,CAAcgC,MAAlB,EAA0B;AACxB/B,QAAAA,OAAO,GAAGA,OAAO,CAAC+E,MAAR,CAAe,KAAKhF,QAApB,CAAV;AACD;;AAED,UAAI1B,QAAQ,CAACI,UAAT,CAAoB,KAAKoB,OAAzB,CAAJ,EAAuC;AACrCG,QAAAA,OAAO,CAACgC,IAAR,CAAa,KAAKnC,OAAlB;AACD;;AAED,UAAIG,OAAO,CAAC+B,MAAZ,EAAoB;AAClB/B,QAAAA,OAAO,CAACgG,OAAR,CAAgB,UAACC,EAAD,EAAQ;AACtBjC,UAAAA,cAAc,CAACiC,EAAE,CAAClD,IAAH,CAAQ,KAAR,EAAcZ,OAAO,CAACgB,MAAtB,EAA8BhB,OAAO,CAACiB,WAAtC,EAAmDiB,IAAnD,CAAD,CAAd;AACD,SAFD;;AAIA,YAAI6B,gBAAgB,GAAG,KAAK3F,aAAL,CAAmByB,IAAnB,CAAwB,YAAM;AACnDmC,UAAAA,QAAQ;;AACR,eAAK,IAAIrC,GAAC,GAAGY,QAAQ,CAACX,MAAT,GAAkB,CAA/B,EAAkCD,GAAC,IAAI,CAAvC,EAA0CA,GAAC,EAA3C,EAA+C;AAC7C,gBAAIY,QAAQ,CAACZ,GAAD,CAAR,CAAYsC,IAAhB,EAAsB;AACpB1B,cAAAA,QAAQ,CAACZ,GAAD,CAAR,CAAYsC,IAAZ;AACD;;AACD,mBAAO1B,QAAQ,CAACZ,GAAD,CAAf;AACD;;AACDY,UAAAA,QAAQ,GAAG,EAAX;AACAF,UAAAA,QAAQ,GAAG,EAAX;AACA1B,UAAAA,aAAa,GAAG,EAAhB;AACAxB,UAAAA,KAAK,GAAG,KAAI,CAACgB,YAAL,GAAoB,IAA5B;;AACA,UAAA,KAAI,CAACC,aAAL,CAAmB4F,MAAnB,CAA0BD,gBAAgB,GAAG,CAA7C,EAAgD,CAAhD;AACD,SAbsB,CAAvB;;AAeAhD,QAAAA,kBAAkB;AAClBS,QAAAA,IAAI,CAAC,CAAD,CAAJ;AACD,OAtBD,MAsBO,IAAIpB,UAAJ,EAAgB;AACrBW,QAAAA,kBAAkB;AAClBQ,QAAAA,YAAY;AACb,OAHM,MAGA,IAAI,KAAKpE,KAAT,EAAgB;AACrB8C,QAAAA,IAAI,CAACD,OAAD,EAAUsB,OAAO,EAAjB,CAAJ;AACD,OAFM,MAEA;AACLrB,QAAAA,IAAI,CAACD,OAAD,CAAJ;AACD;AACF;;;;;SAEDiE,U;wBAAWjE,O,EAAS;AAClB,UAAI,KAAK7C,KAAT,EAAgB;AACd,YAAI,KAAKY,SAAL,IAAkB,CAAC,KAAKI,YAA5B,EAA0C;AACxC,eAAKF,WAAL,IAAoB,KAAKA,WAAL,EAApB;;AACA,eAAKF,SAAL,CAAeiC,OAAO,CAACgB,MAAvB,EAA+BhB,OAAO,CAACiB,WAAvC;AACD,SAHD,MAGO;AACL,eAAKhD,WAAL,IAAoB,KAAKA,WAAL,EAApB;;AACA,eAAKX,OAAL,CAAa0C,OAAO,CAACgB,MAArB,EAA6BhB,OAAO,CAACiB,WAArC,EAAkD,KAAK9C,YAAvD;AACD;AACF,OARD,MAQO;AACL,aAAKF,WAAL,IAAoB,KAAKA,WAAL,EAApB;;AACA,aAAKX,OAAL,CAAa0C,OAAO,CAACgB,MAArB,EAA6BhB,OAAO,CAACiB,WAArC,EAAkD,KAAK9C,YAAvD;AACD;AACF;;;;;SAED+F,iB;+BAAkBlE,O,EAAS;AACzB,WAAKZ,kBAAL;;AACA,UAAI,KAAKxC,KAAT,EAAgB;AACd,aAAKA,KAAL,CAAWsH,iBAAX,CAA6BlE,OAA7B;AACD;;AAED,WAAKtB,cAAL,CAAoBsB,OAAO,CAACgB,MAA5B,EAAoChB,OAAO,CAACiB,WAA5C;AACD;;;;;SAEDkD,Y;4BAAe;AACb,WAAKnF,cAAL,CAAoBoF,MAApB;;AACA,aAAO,KAAKjF,IAAZ;AACD;;;;;SAEDkF,Q;sBAASC,G,EAAK;AACZ,WAAKtF,cAAL,CAAoBoF,MAApB;;AACA,aAAO,KAAKtF,OAAL,CAAayF,GAAb,CAAiBD,GAAjB,CAAP;AACD;;;;;SAEDE,a;2BAAcF,G,EAAK;AACjB,WAAKtF,cAAL,CAAoBoF,MAApB;;AACA,aAAO,KAAKrF,YAAL,CAAkBwF,GAAlB,CAAsBD,GAAtB,CAAP;AACD;;;;;SAEDG,e;+BAAkB;AAChB,WAAKvF,cAAL,CAAoBkF,MAApB;AACD;;;;;SAEDM,kB;kCAAqB;AACnB,WAAK5F,OAAL,GAAe,IAAI3C,YAAJ,EAAf;AACA,WAAK4C,YAAL,GAAoB,IAAI5C,YAAJ,EAApB;;AACA,WAAK6C,cAAL,CAAoB2F,OAApB;;AACA,WAAKzF,cAAL,CAAoByF,OAApB;AACD;;;;;SAEDC,mB;iCAAoBC,c,EAAgBC,a,EAAe;AACjD;AACA,WAAKC,mBAAL,CAAyB,KAAKjG,OAA9B,EAAuC+F,cAAc,CAAC7D,MAAtD,EAFiD,CAIjD;;;AACA,WAAK+D,mBAAL,CAAyB,KAAKhG,YAA9B,EAA4C8F,cAAc,CAAC5D,WAA3D,EALiD,CAOjD;AACA;AACA;AACA;AACA;AACA;;;AACA,UAAG,CAAC6D,aAAJ,EAAmB;AACjB,aAAK5F,cAAL,CAAoByF,OAApB;AACD;AACF;;;;;SAEDI,mB;iCAAoBC,I,EAAMC,S,EAAW;AACnC,UAAMC,WAAW,GAAGxE,MAAM,CAACyE,IAAP,CAAYF,SAAZ,CAApB;AACA,UAAMG,OAAO,GAAG1E,MAAM,CAACyE,IAAP,CAAYH,IAAI,CAACK,OAAjB,CAAhB,CAFmC,CAInC;AACA;AACA;;AACAH,MAAAA,WAAW,CAACrB,OAAZ,CAAoB,UAACS,GAAD,EAAS;AAC3BU,QAAAA,IAAI,CAACM,GAAL,CAAShB,GAAT,EAAcW,SAAS,CAACX,GAAD,CAAvB;AACD,OAFD,EAPmC,CAWnC;;AACAc,MAAAA,OAAO,CAACtC,MAAR,CAAe,UAACnD,CAAD,EAAO;AACpB,eAAOuF,WAAW,CAAChC,OAAZ,CAAoBvD,CAApB,IAAyB,CAAhC;AACD,OAFD,EAEGkE,OAFH,CAEW,UAACS,GAAD,EAAS;AAClBU,QAAAA,IAAI,CAACM,GAAL,CAAShB,GAAT,EAAciB,SAAd;AACD,OAJD;AAKD;;;;;;;;AAzXH3J,MAAM,CAAC4J,aAAP,CA4XehJ,KA5Xf","sourcesContent":["import { Router }       from './_init.js';\nimport { Meteor }       from 'meteor/meteor';\nimport { Promise }      from 'meteor/promise';\nimport { Tracker }      from 'meteor/tracker';\nimport { _helpers }     from './../lib/_helpers.js';\nimport { ReactiveDict } from 'meteor/reactive-dict';\n\nconst makeTriggers = (triggers) => {\n  if (_helpers.isFunction(triggers)) {\n    return [triggers];\n  } else if (!_helpers.isArray(triggers)) {\n    return [];\n  }\n\n  return triggers;\n};\n\nclass Route {\n  constructor(router = new Router(), pathDef, options = {}, group) {\n    this.render           = router.Renderer.render.bind(router.Renderer);\n    this.options          = options;\n    this.globals          = router.globals;\n    this.pathDef          = pathDef;\n\n    // Route.path is deprecated and will be removed in 3.0\n    this.path             = pathDef;\n    this.conf             = options.conf || {};\n    this.group            = group;\n    this._data            = options.data || null;\n    this._router          = router;\n    this._action          = options.action || Function.prototype;\n    this._waitOn          = options.waitOn || null;\n    this._waitFor         = _helpers.isArray(options.waitFor) ? options.waitFor : [];\n    this._subsMap         = {};\n    this._onNoData        = options.onNoData || null;\n    this._endWaiting      = options.endWaiting || null;\n    this._currentData     = null;\n    this._triggersExit    = options.triggersExit ? makeTriggers(options.triggersExit) : [];\n    this._whileWaiting    = options.whileWaiting || null;\n    this._triggersEnter   = options.triggersEnter ? makeTriggers(options.triggersEnter) : [];\n    this._subscriptions   = options.subscriptions || Function.prototype;\n    this._waitOnResources = options.waitOnResources || null;\n\n    this._params          = new ReactiveDict();\n    this._queryParams     = new ReactiveDict();\n    this._routeCloseDep   = new Tracker.Dependency();\n    this._pathChangeDep   = new Tracker.Dependency();\n\n    if (options.name) {\n      this.name = options.name;\n    }\n  }\n\n  clearSubscriptions() {\n    this._subsMap = {};\n  }\n\n  register(name, sub) {\n    this._subsMap[name] = sub;\n  }\n\n  getSubscription(name) {\n    return this._subsMap[name];\n  }\n\n  getAllSubscriptions() {\n    return this._subsMap;\n  }\n\n  checkSubscriptions(subscriptions) {\n    const results = [];\n    for (let i = 0; i < subscriptions.length; i++) {\n      results.push((subscriptions[i] && subscriptions[i].ready) ? subscriptions[i].ready() : false);\n    }\n\n    return !results.includes(false);\n  }\n\n  waitOn(current = {}, next) {\n    let _data         = null;\n    let _isWaiting    = false;\n    let _preloaded    = 0;\n    let _resources    = false;\n    let waitFor       = [];\n    let promises      = [];\n    let subscriptions = [];\n    let timer;\n    let trackers      = [];\n\n    const placeIn = (d) => {\n      if (Object.prototype.toString.call(d) === '[object Promise]' || d.then && Object.prototype.toString.call(d.then) === '[object Function]') {\n        promises.push(d);\n      } else if (d.flush) {\n        trackers.push(d);\n      } else if (d.ready) {\n        subscriptions.push(d);\n      }\n    };\n\n    const whileWaitingAction = () => {\n      if (!_isWaiting) {\n        this._whileWaiting && this._whileWaiting(current.params, current.queryParams);\n        _isWaiting = true;\n      }\n    };\n\n    const subWait = (delay) => {\n      timer = Meteor.setTimeout(() => {\n        if (this.checkSubscriptions(subscriptions)) {\n          Meteor.clearTimeout(timer);\n          _data = getData();\n          if (_resources) {\n            whileWaitingAction();\n            getResources();\n          } else {\n            next(current, _data);\n          }\n        } else {\n          wait(25);\n        }\n      }, delay);\n    };\n\n    const wait = (delay) => {\n      if (promises.length) {\n        Promise.all(promises).then(() => {\n          subWait(delay);\n          promises = [];\n        }).catch((error) => {\n          Meteor._debug('[ostrio:flow-router-extra] [route.wait] Promise not resolved', error);\n        });\n      } else {\n        subWait(delay);\n      }\n    };\n\n    const processSubData = (subData) => {\n      if (subData instanceof Array) {\n        for (let i = subData.length - 1; i >= 0; i--) {\n          if (subData[i] !== null && typeof subData[i] === 'object') {\n            placeIn(subData[i]);\n          }\n        }\n      } else if (subData !== null && typeof subData === 'object') {\n        placeIn(subData);\n      }\n    };\n\n    const stopSubs = () => {\n      for (let i = subscriptions.length - 1; i >= 0; i--) {\n        if (subscriptions[i].stop) {\n          subscriptions[i].stop();\n        }\n        delete subscriptions[i];\n      }\n      subscriptions = [];\n    };\n\n    const done = (subscription) => {\n      processSubData(_helpers.isFunction(subscription) ? subscription() : subscription);\n    };\n\n    if (current.route.globals.length) {\n      for (let i = 0; i < current.route.globals.length; i++) {\n        if (typeof current.route.globals[i] === 'object') {\n          if (current.route.globals[i].waitOnResources) {\n            if (!_resources) { _resources = []; }\n            _resources.push(current.route.globals[i].waitOnResources);\n          }\n\n          if (current.route.globals[i].waitOn && _helpers.isFunction(current.route.globals[i].waitOn)) {\n            waitFor.unshift(current.route.globals[i].waitOn);\n          }\n        }\n      }\n    }\n\n    if (this._waitOnResources) {\n      if (!_resources) { _resources = []; }\n      _resources.push(this._waitOnResources);\n    }\n\n    const preload = (len, __data) => {\n      _preloaded++;\n      if (_preloaded >= len) {\n        next(current, __data);\n      }\n    };\n\n    const getData = () => {\n      if (this._data) {\n        if (!_data) {\n          _data = this._currentData = this._data(current.params, current.queryParams);\n        } else {\n          _data = this._currentData;\n        }\n      }\n      return _data;\n    };\n\n    const getResources = () => {\n      _data      = getData();\n      let len    = 0;\n      let items;\n      let images = [];\n      let other  = [];\n      for (let i = _resources.length - 1; i >= 0; i--) {\n        items = _resources[i].call(this, current.params, current.queryParams, _data);\n        if (items) {\n          if (items.images && items.images.length) {\n            images = images.concat(items.images);\n          }\n          if (items.other && items.other.length) {\n            other = other.concat(items.other);\n          }\n        }\n      }\n\n      if ((other && other.length) || (images && images.length)) {\n        if (other && other.length && typeof XMLHttpRequest !== 'undefined') {\n          other = other.filter((elem, index, self) => {\n            return index === self.indexOf(elem);\n          });\n          len += other.length;\n          const prefetch = {};\n          for (let k = other.length - 1; k >= 0; k--) {\n            prefetch[k] = new XMLHttpRequest();\n            prefetch[k].onload  = () => { preload(len, _data); };\n            prefetch[k].onerror = () => { preload(len, _data); };\n            prefetch[k].open('GET', other[k]);\n            prefetch[k].send(null);\n          }\n        }\n\n        if (images && images.length){\n          images = images.filter((elem, index, self) => {\n            return index === self.indexOf(elem);\n          });\n          len += images.length;\n          const imgs = {};\n          for (let j = images.length - 1; j >= 0; j--) {\n            imgs[j]         = new Image();\n            imgs[j].onload  = () => { preload(len, _data); };\n            imgs[j].onerror = () => { preload(len, _data); };\n            imgs[j].src     = images[j];\n          }\n        }\n      } else {\n        next(current, _data);\n      }\n    };\n\n    if (this._waitFor.length) {\n      waitFor = waitFor.concat(this._waitFor);\n    }\n\n    if (_helpers.isFunction(this._waitOn)) {\n      waitFor.push(this._waitOn);\n    }\n\n    if (waitFor.length) {\n      waitFor.forEach((wo) => {\n        processSubData(wo.call(this, current.params, current.queryParams, done));\n      });\n\n      let triggerExitIndex = this._triggersExit.push(() => {\n        stopSubs();\n        for (let i = trackers.length - 1; i >= 0; i--) {\n          if (trackers[i].stop) {\n            trackers[i].stop();\n          }\n          delete trackers[i];\n        }\n        trackers = [];\n        promises = [];\n        subscriptions = [];\n        _data = this._currentData = null;\n        this._triggersExit.splice(triggerExitIndex - 1, 1);\n      });\n\n      whileWaitingAction();\n      wait(0);\n    } else if (_resources) {\n      whileWaitingAction();\n      getResources();\n    } else if (this._data) {\n      next(current, getData());\n    } else {\n      next(current);\n    }\n  }\n\n  callAction(current) {\n    if (this._data) {\n      if (this._onNoData && !this._currentData) {\n        this._endWaiting && this._endWaiting();\n        this._onNoData(current.params, current.queryParams);\n      } else {\n        this._endWaiting && this._endWaiting();\n        this._action(current.params, current.queryParams, this._currentData);\n      }\n    } else {\n      this._endWaiting && this._endWaiting();\n      this._action(current.params, current.queryParams, this._currentData);\n    }\n  }\n\n  callSubscriptions(current) {\n    this.clearSubscriptions();\n    if (this.group) {\n      this.group.callSubscriptions(current);\n    }\n\n    this._subscriptions(current.params, current.queryParams);\n  }\n\n  getRouteName() {\n    this._routeCloseDep.depend();\n    return this.name;\n  }\n\n  getParam(key) {\n    this._routeCloseDep.depend();\n    return this._params.get(key);\n  }\n\n  getQueryParam(key) {\n    this._routeCloseDep.depend();\n    return this._queryParams.get(key);\n  }\n\n  watchPathChange() {\n    this._pathChangeDep.depend();\n  }\n\n  registerRouteClose() {\n    this._params = new ReactiveDict();\n    this._queryParams = new ReactiveDict();\n    this._routeCloseDep.changed();\n    this._pathChangeDep.changed();\n  }\n\n  registerRouteChange(currentContext, routeChanging) {\n    // register params\n    this._updateReactiveDict(this._params, currentContext.params);\n\n    // register query params\n    this._updateReactiveDict(this._queryParams, currentContext.queryParams);\n\n    // if the route is changing, we need to defer triggering path changing\n    // if we did this, old route's path watchers will detect this\n    // Real issue is, above watcher will get removed with the new route\n    // So, we don't need to trigger it now\n    // We are doing it on the route close event. So, if they exists they'll\n    // get notify that\n    if(!routeChanging) {\n      this._pathChangeDep.changed();\n    }\n  }\n\n  _updateReactiveDict(dict, newValues) {\n    const currentKeys = Object.keys(newValues);\n    const oldKeys = Object.keys(dict.keyDeps);\n\n    // set new values\n    //  params is an array. So, currentKeys.forEach() does not works\n    //  to iterate params\n    currentKeys.forEach((key) => {\n      dict.set(key, newValues[key]);\n    });\n\n    // remove keys which does not exisits here\n    oldKeys.filter((i) => {\n      return currentKeys.indexOf(i) < 0;\n    }).forEach((key) => {\n      dict.set(key, undefined);\n    });\n  }\n}\n\nexport default Route;\n"]},"sourceType":"script","hash":"aaa6d1e7b9a626cf011017890ca368ce13690441"}
