{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/renderer.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ostrio:flow-router-extra/client/renderer.js","filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/renderer.js","passPerPreset":false,"envName":"development","cwd":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","root":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/renderer.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:flow-router-extra/client/renderer.js"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\n\nlet _helpers;\n\nmodule.link(\"./../lib/_helpers.js\", {\n  _helpers(v) {\n    _helpers = v;\n  }\n\n}, 1);\nlet requestAnimFrame;\nmodule.link(\"./modules.js\", {\n  requestAnimFrame(v) {\n    requestAnimFrame = v;\n  }\n\n}, 2);\nlet Blaze;\nlet Template;\n\nif (Package.templating && Package.blaze) {\n  Blaze = Package.blaze.Blaze;\n  Template = Package.templating.Template;\n}\n\nconst _BlazeRemove = function (view) {\n  try {\n    Blaze.remove(view);\n  } catch (_e) {\n    try {\n      Blaze._destroyView(view);\n\n      view._domrange.destroy();\n    } catch (__e) {\n      view._domrange.destroy();\n    }\n  }\n};\n\nclass BlazeRenderer {\n  constructor() {\n    let opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    this.rootElement = opts.rootElement || function () {\n      return document.body;\n    };\n\n    const self = this;\n    this.isRendering = false;\n    this.queue = [];\n    this.yield = null;\n    this.cache = {};\n    this.old = this.newState();\n    this.old.materialized = true;\n    this.inMemoryRendering = opts.inMemoryRendering || false;\n\n    this.getMemoryElement = opts.getMemoryElement || function () {\n      return document.createElement('div');\n    };\n\n    if (!this.getMemoryElement || !_helpers.isFunction(this.getMemoryElement)) {\n      throw new Meteor.Error(400, '{getMemoryElement} must be a function, which returns new DOM element');\n    }\n\n    if (!this.rootElement || !_helpers.isFunction(this.rootElement)) {\n      throw new Meteor.Error(400, 'You must pass function into BlazeRenderer constructor, which returns DOM element');\n    }\n\n    Template.yield = new Template('yield', function () {});\n    Template.yield.onCreated(function () {\n      self.yield = this;\n    });\n    Template.yield.onRendered(function () {\n      self.yield = this;\n      self.materialize(self.old);\n    });\n    Template.yield.onDestroyed(function () {\n      if (self.old.template.view) {\n        _BlazeRemove(self.old.template.view);\n\n        self.old.template.view = null;\n        self.old.materialized = false;\n      }\n\n      self.yield = null;\n    });\n  }\n\n  render(__layout) {\n    let __template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    let __data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    let __callback = arguments.length > 3 ? arguments[3] : undefined;\n\n    if (!Blaze || !Template) {\n      throw new Meteor.Error(400, '`.render()` - Requires `blaze` and `templating`, or `blaze-html-templates` packages to be installed');\n    }\n\n    if (!__layout) {\n      throw new Meteor.Error(400, '`.render()` - Requires at least one argument');\n    } else if (!_helpers.isString(__layout) && !(__layout instanceof Blaze.Template)) {\n      throw new Meteor.Error(400, '`.render()` - First argument must be a String or instance of Blaze.Template');\n    }\n\n    this.queue.push([__layout, __template, __data, __callback]);\n    this.startQueue();\n  }\n\n  startQueue() {\n    if (this.queue.length) {\n      if (!this.isRendering) {\n        this.isRendering = true;\n        const task = this.queue.shift();\n        this.proceed.apply(this, task);\n\n        if (this.queue.length) {\n          requestAnimFrame(this.startQueue.bind(this));\n        }\n      } else {\n        requestAnimFrame(this.startQueue.bind(this));\n      }\n    }\n  }\n\n  proceed(__layout) {\n    let __template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    let __data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    let __callback = arguments.length > 3 ? arguments[3] : undefined;\n\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    let data = __data;\n    let layout = __layout;\n    let _layout = false;\n    let template = __template;\n    let _template = false;\n\n    let callback = __callback || (() => {});\n\n    if (_helpers.isString(layout)) {\n      _layout = typeof Template !== 'undefined' && Template !== null ? Template[layout] : void 0;\n    } else if (layout instanceof Blaze.Template) {\n      _layout = layout;\n      layout = layout.viewName.replace('Template.', '');\n    } else {\n      layout = false;\n    }\n\n    if (_helpers.isString(template)) {\n      _template = typeof Template !== 'undefined' && Template !== null ? Template[template] : void 0;\n    } else if (template instanceof Blaze.Template) {\n      _template = template;\n      template = template.viewName.replace('Template.', '');\n    } else if (_helpers.isObject(template)) {\n      data = template;\n      template = false;\n    } else if (_helpers.isFunction(template)) {\n      callback = template;\n      template = false;\n    } else {\n      template = false;\n    }\n\n    if (_helpers.isFunction(data)) {\n      callback = data;\n      data = {};\n    } else if (!_helpers.isObject(data)) {\n      data = {};\n    }\n\n    if (!_helpers.isFunction(callback)) {\n      callback = () => {};\n    }\n\n    if (!_layout) {\n      this.old.materialized = true;\n      this.isRendering = false;\n      throw new Meteor.Error(404, 'No such layout: ' + layout);\n    }\n\n    const current = this.newState(layout, template);\n    current.data = data;\n    current.callback = callback;\n    let updateTemplate = true;\n\n    if (this.old.template.name !== template) {\n      current.template.name = template;\n      current.template.blaze = _template;\n      this.newElement('template', current);\n\n      if (this.old.template.view) {\n        _BlazeRemove(this.old.template.view);\n\n        this.old.template.view = null;\n        this.old.materialized = false;\n      }\n\n      updateTemplate = false;\n    } else {\n      current.template = this.old.template;\n    }\n\n    if (this.old.layout.name !== layout) {\n      current.layout.name = layout;\n      current.layout.blaze = _layout;\n      current.template.name = template;\n      current.template.blaze = _template;\n      this.newElement('layout', current);\n\n      if (this.old.layout.view) {\n        _BlazeRemove(this.old.layout.view);\n\n        this.old.layout.view = null;\n      }\n\n      this._render(current);\n    } else if (template) {\n      current.layout = this.old.layout;\n      current.template.name = template;\n      current.template.blaze = _template;\n\n      this._load(updateTemplate, true, current);\n    } else {\n      current.layout = this.old.layout;\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n\n      current.callback = () => {};\n    }\n\n    this.old = current;\n  }\n\n  _render(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    const getData = () => {\n      return current.data;\n    };\n\n    const rootElement = this.rootElement();\n\n    if (!rootElement) {\n      throw new Meteor.Error(400, 'BlazeRenderer can\\'t find root element!');\n    }\n\n    if (this.inMemoryRendering) {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, current.layout.element);\n      requestAnimFrame(() => {\n        rootElement.appendChild(current.layout.element);\n\n        this._load(false, false, current);\n      });\n    } else {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, rootElement);\n\n      this._load(false, false, current);\n    }\n  }\n\n  _load(updateTemplate, updateLayout, current) {\n    if (updateLayout && current.layout.view) {\n      current.layout.view.dataVar.set(current.data);\n    }\n\n    if (current.template.view && updateTemplate) {\n      current.template.view.dataVar.set(current.data);\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n\n      current.callback = () => {};\n    } else if (!current.template.name) {\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n\n      current.callback = () => {};\n    } else if (current.template.name && !this.yield) {\n      this.isRendering = false;\n      current.materialized = false;\n      current.callback();\n\n      current.callback = () => {};\n    } else if (current.template.name && this.yield) {\n      this.materialize(current);\n    }\n  }\n\n  newElement(type, current) {\n    if (!this.inMemoryRendering) {\n      return;\n    }\n\n    current[type].parent = current[type].parent ? current[type].parent : document.createElement('div');\n\n    if (!current[type].element) {\n      current[type].element = this.getMemoryElement();\n      current[type].parent.appendChild(current[type].element);\n      current[type].element._parentElement = current[type].parent;\n    }\n  }\n\n  newState() {\n    let layout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    let template = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    const base = {\n      materialized: false,\n      data: null,\n      callback: function () {},\n      layout: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      },\n      template: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      }\n    };\n\n    if (!this.inMemoryRendering || !layout && !template) {\n      return base;\n    }\n\n    if (layout && this.cache[layout]) {\n      base.layout = this.cache[layout];\n    }\n\n    if (template && this.cache[template]) {\n      base.template = this.cache[template];\n    }\n\n    this.cache[template] = base;\n    return base;\n  }\n\n  materialize(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    if (current.template.name && !current.materialized) {\n      const getData = () => {\n        return current.data;\n      };\n\n      if (!this.yield) {\n        current.materialized = false;\n        return;\n      }\n\n      current.materialized = true;\n\n      if (this.inMemoryRendering) {\n        current.template.view = Blaze.renderWithData(current.template.blaze, getData, current.template.element, this.yield.view);\n\n        if (this.yield) {\n          this.yield.view._domrange.parentElement.appendChild(current.template.element);\n\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      } else {\n        if (this.yield) {\n          current.template.view = Blaze.renderWithData(current.template.blaze, getData, this.yield.view._domrange.parentElement, this.yield.view);\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      }\n    }\n  }\n\n}\n\nmodule.exportDefault(BlazeRenderer);","map":{"version":3,"sources":["packages/ostrio:flow-router-extra/client/renderer.js"],"names":["Meteor","module","link","v","_helpers","requestAnimFrame","Blaze","Template","Package","templating","blaze","_BlazeRemove","view","remove","_e","_destroyView","_domrange","destroy","__e","BlazeRenderer","constructor","opts","rootElement","document","body","self","isRendering","queue","yield","cache","old","newState","materialized","inMemoryRendering","getMemoryElement","createElement","isFunction","Error","onCreated","onRendered","materialize","onDestroyed","template","render","__layout","__template","__data","__callback","isString","push","startQueue","length","task","shift","proceed","apply","bind","data","layout","_layout","_template","callback","viewName","replace","isObject","current","updateTemplate","name","newElement","_render","_load","getData","renderWithData","element","appendChild","updateLayout","dataVar","set","type","parent","_parentElement","base","parentElement","exportDefault"],"mappings":"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","sourcesContent":["import { Meteor }           from 'meteor/meteor';\nimport { _helpers }         from './../lib/_helpers.js';\nimport { requestAnimFrame } from './modules.js';\n\nlet Blaze;\nlet Template;\n\nif (Package.templating && Package.blaze) {\n  Blaze    = Package.blaze.Blaze;\n  Template = Package.templating.Template;\n}\n\nconst _BlazeRemove = function (view) {\n  try {\n    Blaze.remove(view);\n  } catch (_e) {\n    try {\n      Blaze._destroyView(view);\n      view._domrange.destroy();\n    } catch (__e) {\n      view._domrange.destroy();\n    }\n  }\n};\n\nclass BlazeRenderer {\n  constructor(opts = {}) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    this.rootElement  = opts.rootElement || function () {\n      return document.body;\n    };\n\n    const self        = this;\n    this.isRendering  = false;\n    this.queue        = [];\n    this.yield        = null;\n    this.cache        = {};\n    this.old          = this.newState();\n    this.old.materialized = true;\n\n    this.inMemoryRendering = opts.inMemoryRendering || false;\n    this.getMemoryElement  = opts.getMemoryElement || function () {\n      return document.createElement('div');\n    };\n\n    if (!this.getMemoryElement || !_helpers.isFunction(this.getMemoryElement)) {\n      throw new Meteor.Error(400, '{getMemoryElement} must be a function, which returns new DOM element');\n    }\n\n    if (!this.rootElement || !_helpers.isFunction(this.rootElement)) {\n      throw new Meteor.Error(400, 'You must pass function into BlazeRenderer constructor, which returns DOM element');\n    }\n\n    Template.yield = new Template('yield', function () {});\n\n    Template.yield.onCreated(function () {\n      self.yield = this;\n    });\n\n    Template.yield.onRendered(function () {\n      self.yield = this;\n      self.materialize(self.old);\n    });\n\n    Template.yield.onDestroyed(function () {\n      if (self.old.template.view) {\n        _BlazeRemove(self.old.template.view);\n        self.old.template.view = null;\n        self.old.materialized = false;\n      }\n      self.yield = null;\n    });\n  }\n\n  render(__layout, __template = false, __data = {}, __callback) {\n    if (!Blaze || !Template) {\n      throw new Meteor.Error(400, '`.render()` - Requires `blaze` and `templating`, or `blaze-html-templates` packages to be installed');\n    }\n\n    if (!__layout) {\n      throw new Meteor.Error(400, '`.render()` - Requires at least one argument');\n    } else if (!_helpers.isString(__layout) && !(__layout instanceof Blaze.Template)) {\n      throw new Meteor.Error(400, '`.render()` - First argument must be a String or instance of Blaze.Template');\n    }\n\n    this.queue.push([__layout, __template, __data, __callback]);\n    this.startQueue();\n  }\n\n  startQueue() {\n    if (this.queue.length) {\n      if (!this.isRendering) {\n        this.isRendering = true;\n        const task = this.queue.shift();\n        this.proceed.apply(this, task);\n        if (this.queue.length) {\n          requestAnimFrame(this.startQueue.bind(this));\n        }\n      } else {\n        requestAnimFrame(this.startQueue.bind(this));\n      }\n    }\n  }\n\n  proceed(__layout, __template = false, __data = {}, __callback) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    let data      = __data;\n    let layout    = __layout;\n    let _layout   = false;\n    let template  = __template;\n    let _template = false;\n    let callback  = __callback || (() => {});\n\n    if (_helpers.isString(layout)) {\n      _layout = typeof Template !== 'undefined' && Template !== null ? Template[layout] : void 0;\n    } else if (layout instanceof Blaze.Template) {\n      _layout = layout;\n      layout  = layout.viewName.replace('Template.', '');\n    } else {\n      layout = false;\n    }\n\n    if (_helpers.isString(template)) {\n      _template = typeof Template !== 'undefined' && Template !== null ? Template[template] : void 0;\n    } else if (template instanceof Blaze.Template) {\n      _template = template;\n      template  = template.viewName.replace('Template.', '');\n    } else if (_helpers.isObject(template)) {\n      data     = template;\n      template = false;\n    } else if (_helpers.isFunction(template)) {\n      callback = template;\n      template = false;\n    } else {\n      template = false;\n    }\n\n    if (_helpers.isFunction(data)) {\n      callback = data;\n      data = {};\n    } else if (!_helpers.isObject(data)) {\n      data = {};\n    }\n\n    if (!_helpers.isFunction(callback)) {\n      callback = () => {};\n    }\n\n    if (!_layout) {\n      this.old.materialized = true;\n      this.isRendering = false;\n      throw new Meteor.Error(404, 'No such layout: ' + layout);\n    }\n\n    const current      = this.newState(layout, template);\n    current.data       = data;\n    current.callback   = callback;\n    let updateTemplate = true;\n\n    if (this.old.template.name !== template) {\n      current.template.name  = template;\n      current.template.blaze = _template;\n      this.newElement('template', current);\n      if (this.old.template.view) {\n        _BlazeRemove(this.old.template.view);\n        this.old.template.view = null;\n        this.old.materialized = false;\n      }\n\n      updateTemplate = false;\n    } else {\n      current.template = this.old.template;\n    }\n\n    if (this.old.layout.name !== layout) {\n      current.layout.name    = layout;\n      current.layout.blaze   = _layout;\n      current.template.name  = template;\n      current.template.blaze = _template;\n      this.newElement('layout', current);\n\n      if (this.old.layout.view) {\n        _BlazeRemove(this.old.layout.view);\n        this.old.layout.view = null;\n      }\n\n      this._render(current);\n    } else if (template) {\n      current.layout         = this.old.layout;\n      current.template.name  = template;\n      current.template.blaze = _template;\n      this._load(updateTemplate, true, current);\n    } else {\n      current.layout = this.old.layout;\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    }\n\n    this.old = current;\n  }\n\n  _render(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    const getData = () => {\n      return current.data;\n    };\n\n    const rootElement = this.rootElement();\n    if (!rootElement) {\n      throw new Meteor.Error(400, 'BlazeRenderer can\\'t find root element!');\n    }\n\n    if (this.inMemoryRendering) {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, current.layout.element);\n      requestAnimFrame(() => {\n        rootElement.appendChild(current.layout.element);\n        this._load(false, false, current);\n      });\n    } else {\n      current.layout.view = Blaze.renderWithData(current.layout.blaze, getData, rootElement);\n      this._load(false, false, current);\n    }\n  }\n\n  _load(updateTemplate, updateLayout, current) {\n    if (updateLayout && current.layout.view) {\n      current.layout.view.dataVar.set(current.data);\n    }\n\n    if (current.template.view && updateTemplate) {\n      current.template.view.dataVar.set(current.data);\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    } else if (!current.template.name) {\n      this.isRendering = false;\n      current.materialized = true;\n      current.callback();\n      current.callback = () => {};\n    } else if (current.template.name && !this.yield) {\n      this.isRendering = false;\n      current.materialized = false;\n      current.callback();\n      current.callback = () => {};\n    } else if (current.template.name && this.yield) {\n      this.materialize(current);\n    }\n  }\n\n  newElement(type, current) {\n    if (!this.inMemoryRendering) {\n      return;\n    }\n\n    current[type].parent  = current[type].parent ? current[type].parent : document.createElement('div');\n    if (!current[type].element) {\n      current[type].element = this.getMemoryElement();\n      current[type].parent.appendChild(current[type].element);\n      current[type].element._parentElement = current[type].parent;\n    }\n  }\n\n  newState(layout = false, template = false) {\n    const base = {\n      materialized: false,\n      data: null,\n      callback: function () {},\n      layout: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      },\n      template: {\n        view: null,\n        name: '',\n        blaze: null,\n        parent: null,\n        element: null\n      }\n    };\n\n    if (!this.inMemoryRendering || (!layout && !template)) {\n      return base;\n    }\n\n    if (layout && this.cache[layout]) {\n      base.layout = this.cache[layout];\n    }\n\n    if (template && this.cache[template]) {\n      base.template = this.cache[template];\n    }\n\n    this.cache[template] = base;\n    return base;\n  }\n\n  materialize(current) {\n    if (!Blaze || !Template) {\n      return;\n    }\n\n    if (current.template.name && !current.materialized) {\n      const getData = () => {\n        return current.data;\n      };\n\n      if (!this.yield) {\n        current.materialized = false;\n        return;\n      }\n\n      current.materialized = true;\n      if (this.inMemoryRendering) {\n        current.template.view = Blaze.renderWithData(current.template.blaze, getData, current.template.element, this.yield.view);\n        if (this.yield) {\n          this.yield.view._domrange.parentElement.appendChild(current.template.element);\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      } else {\n        if (this.yield) {\n          current.template.view = Blaze.renderWithData(current.template.blaze, getData, this.yield.view._domrange.parentElement, this.yield.view);\n          this.isRendering = false;\n          current.materialized = true;\n          current.callback();\n          current.callback = () => {};\n        } else {\n          current.materialized = false;\n        }\n      }\n    }\n  }\n}\n\nexport default BlazeRenderer;\n"]},"sourceType":"script","hash":"350d0d291ca6d5bc841a8167cb56c1de990da5f5"}
