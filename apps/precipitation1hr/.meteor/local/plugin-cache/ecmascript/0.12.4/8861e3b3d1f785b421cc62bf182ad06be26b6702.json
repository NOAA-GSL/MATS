{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/randyp:mats-common/templates/common/select.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/randyp:mats-common/templates/common/select.js","filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/randyp:mats-common/templates/common/select.js","passPerPreset":false,"envName":"development","cwd":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","root":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/randyp:mats-common/templates/common/select.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/randyp:mats-common/templates/common/select.js"}},"code":"let matsTypes;\nmodule.link(\"meteor/randyp:mats-common\", {\n  matsTypes(v) {\n    matsTypes = v;\n  }\n\n}, 0);\nlet matsCollections;\nmodule.link(\"meteor/randyp:mats-common\", {\n  matsCollections(v) {\n    matsCollections = v;\n  }\n\n}, 1);\nlet matsParamUtils;\nmodule.link(\"meteor/randyp:mats-common\", {\n  matsParamUtils(v) {\n    matsParamUtils = v;\n  }\n\n}, 2);\nlet matsSelectUtils;\nmodule.link(\"meteor/randyp:mats-common\", {\n  matsSelectUtils(v) {\n    matsSelectUtils = v;\n  }\n\n}, 3);\n\n/*\n    Much of the work for select widgets happens in mats-common->imports->client->select_util.js. Especially the refresh\n    routine which sets all the options. Don't forget to look there for much of the handling.\n */\nTemplate.select.onRendered(function () {\n  const ref = this.data.name + '-' + this.data.type;\n  $(\"#\" + ref).select2({\n    minimumResultsForSearch: 20,\n    closeOnSelect: false\n  });\n  const elem = document.getElementById(ref);\n\n  try {\n    // register refresh event for axis change to use to enforce a refresh\n    elem && elem.addEventListener('axisRefresh', function (event) {\n      // Don't know why I have to do this, I expected the parameter data to be in the context....\n      const paramData = matsCollections.CurveParams.findOne({\n        name: this.name\n      }, {\n        dependentNames: 1,\n        peerName: 1\n      });\n      matsSelectUtils.refreshPeer(event, paramData);\n    }); // register refresh event for any superior to use to enforce a refresh of the options list\n\n    if (ref.search('axis') === 1) {\n      // this is a \"brother\" (hidden) scatterplot param. There is no need to refresh it or add event listeners etc.\n      return;\n    }\n\n    elem.options = [];\n    elem && elem.addEventListener('refresh', function (event) {\n      matsSelectUtils.refresh(event, this.name);\n    });\n  } catch (e) {\n    e.message = \"Error in select.js rendered: \" + e.message;\n    setError(e);\n  }\n\n  try {\n    matsSelectUtils.checkHideOther(this.data, true); // calls checkDisable\n\n    matsSelectUtils.refresh(null, this.data.name);\n  } catch (e) {\n    e.message = \"Error in select.js rendered function checking to hide or disable other elements: \" + e.message;\n    setError(e);\n  }\n});\nTemplate.select.helpers({\n  optionMaxLength: function () {\n    var sOptions = [];\n\n    if (!this.options) {\n      return 10;\n    }\n\n    const longest = this.options.reduce(function (a, b) {\n      if (a === null && b === null) {\n        return null;\n      }\n\n      if (a === null) {\n        return b;\n      }\n\n      if (b === null) {\n        return a;\n      }\n\n      return a.length > b.length ? a : b;\n    });\n\n    if (!longest) {\n      return 10;\n    }\n\n    const ret = longest.length <= 10 ? 10 : Math.round(longest.length * 0.8);\n    return ret;\n  },\n  isSelectedByDefault: function (p) {\n    if (p.default == this) {\n      return \"selected\"; // the selected option\n    } else {\n      return \"\"; // not the selected option\n    }\n  },\n  options: function () {\n    var sOptions = []; //process options as an option list\n\n    if (this.options === matsTypes.InputTypes.unused) {\n      return [];\n    } else if (this.optionsGroups) {\n      // options have optionGroups\n      this.optionsGroups.foreach(function (value) {\n        Soptions.concat(value);\n      });\n    } else {\n      sOptions = matsParamUtils.typeSort(this.options);\n    }\n\n    return sOptions;\n  },\n  multiple: function () {\n    if (this.multiple === true) {\n      return \"multiple\";\n    }\n  },\n  isMultiple: function () {\n    return this.multiple === true;\n  },\n  selectionIsOptional: function () {\n    return this.selectionOptional === true;\n  }\n});\n\nconst setValue = function (pName) {\n  const elem = matsParamUtils.getInputElementForParamName(pName);\n  const selectedOptions = elem.selectedOptions;\n  const options = elem.options;\n\n  if (selectedOptions === undefined || selectedOptions.length === 0 || elem.selectedIndex === -1) {\n    // set to the default - the 0th one\n    matsParamUtils.setValueTextForParamName(pName, matsTypes.InputTypes.unused);\n  } else {\n    if (selectedOptions.length === 1) {\n      matsParamUtils.setValueTextForParamName(pName, selectedOptions[0].text);\n    } else {\n      // selected options is greater than 1 - must be a multiple\n      const firstOption = selectedOptions[0];\n      const lastOption = selectedOptions[selectedOptions.length - 1];\n      const text = firstOption.text + \" .. \" + lastOption.text;\n      matsParamUtils.setValueTextForParamName(pName, text);\n    }\n  }\n};\n\nTemplate.select.events({\n  'change .data-input': function (event) {\n    Session.set(\"elementChanged\", Date.now());\n    const paramName = event.target.name;\n\n    if (paramName === undefined) {\n      return false;\n    } // These need to be done in the right order!\n    // always check to see if an \"other\" needs to be hidden or disabled before refreshing\n\n\n    matsSelectUtils.checkHideOther(this, false);\n    matsSelectUtils.refreshPeer(event, this);\n    document.getElementById(\"element-\" + this.name).style.display = \"none\"; // be sure to hide the element div\n\n    const curveItem = document.getElementById(\"curveItem-\" + Session.get(\"editMode\"));\n    curveItem && curveItem.scrollIntoView(false);\n    setValue(paramName);\n\n    if (this.multiple) {\n      return true; // prevents the select 2 from closing on multiple selectors\n    }\n\n    $('#' + this.name + \"-\" + this.type).select2('close');\n    matsSelectUtils.refreshDependents(event, this);\n    Session.set('lastUpdate', Date.now());\n    return false;\n  },\n  'click .doneSelecting': function (event) {\n    Session.set(\"elementChanged\", Date.now());\n    const controlElem = matsParamUtils.getControlElementForParamName(this.name);\n    $('#' + this.name + \"-\" + this.type).select2(\"close\").trigger('change'); // apply the selection choices to the select2\n\n    const editMode = Session.get(\"editMode\");\n    const curveItem = editMode === undefined && editMode === \"\" ? undefined : document.getElementById(\"curveItem-\" + editMode);\n\n    if (curveItem) {\n      $('#save').trigger('click');\n    }\n\n    if (editMode) {\n      $('#' + this.name + \"-\" + this.type).select2(\"close\"); // use the close on the selector when editing\n    } else {\n      $(controlElem).trigger('click'); // clicking the control element hides the selector when not editing\n\n      $('#' + this.name + \"-\" + this.type).select2(\"close\");\n    }\n\n    return false;\n  },\n  'click .selectAll': function (event) {\n    const elem = matsParamUtils.getInputElementForParamName(this.name);\n    var values = [];\n\n    for (var i = 0; i < elem.options.length; i++) {\n      values.push(elem.options[i].text);\n    }\n\n    $('#' + this.name + \"-\" + this.type).select2().val(values).trigger('change');\n    return false;\n  },\n  'click .clearSelections': function (event) {\n    const elem = matsParamUtils.getInputElementForParamName(this.name);\n    $('#' + this.name + \"-\" + this.type).select2().val(null).trigger('change');\n    return false;\n  },\n  'click .doNotUse': function (event) {\n    const elem = matsParamUtils.getInputElementForParamName(this.name);\n    $('#' + this.name + \"-\" + this.type).select2().val(null).trigger('change');\n    return false;\n  },\n  'change, blur .item': function (event) {\n    try {\n      var text = \"\";\n\n      if (this.type == matsTypes.InputTypes.selectOrderEnforced) {\n        /* check the validity of the order enforcement.\n           The requirement for order enforced selectors is that\n           some curve must have previously selected the earlier (lower ordered)\n           options in the options array, not counting the default option to make this a valid selection.\n           For example if my options are... ['auto by variable','y1','y2',y3'] and 'auto by variable'\n           is the selectors default then choosing 'y2' or 'y3' prior to choosing 'y1' is not valid and\n           choosing 'y3' prior to choosing 'y1' and 'y2' is not valid.\n         */\n        // what is the default?\n        var defaultOption = this.default;\n        var selection = $(event.target).val();\n        var curves = Session.get('Curves');\n        var options = this.options;\n        var priorSelected = [defaultOption];\n\n        for (var ci = 0; ci < curves.length; ci++) {\n          var curve = curves[ci];\n          var curveOption = curve[this.name];\n          priorSelected.push(curveOption);\n        }\n\n        var unusedOption = \"\";\n\n        if (!priorSelected.includes(selection)) {\n          // this option has not been selected prior\n          // check to see if all the prior options to this one are selected\n          for (var oi = 0; oi < options.length; oi++) {\n            var option = options[oi]; // We reached the selected option\n\n            if (option == selection) {\n              break;\n            }\n\n            if (!priorSelected.includes(option)) {\n              unusedOption = option;\n              break;\n            }\n          }\n\n          if (unusedOption === \"\") {\n            // is valid all prior options were selected\n            event.target.setCustomValidity(this.name, \"\");\n          } else {\n            // HACK ALERT! the customValidity stuff seems to have been overridden in the invalid event event handler of item.js\n            Session.set('errorMessage', \"The prior option: \" + unusedOption + \" was not selected for this selector, you must use that first.\");\n            event.target.setCustomValidity(this.name, \"The prior option: \" + unusedOption + \" was not selected for this selector, you must use that first.\");\n            event.target.checkValidity(); //                        matsParamUtils.setInputForParamName(this.name,this.default);\n          }\n        }\n      }\n\n      if (event.target.multiple) {\n        const values = $(event.target).val();\n\n        if (values === null) {\n          // happens if unused or empty\n          text = matsTypes.InputTypes.unused;\n        } else {\n          const firstOption = values[0];\n          const lastOption = values[values.length - 1];\n          text = firstOption + \" .. \" + lastOption;\n        }\n      } else {\n        text = $(event.target).val();\n      }\n\n      if (this.type === matsTypes.InputTypes.select && (text === \"\" || text === undefined || text === null) && (this.default === -1 || this.default === undefined || this.default === null || event.currentTarget.selectedIndex == -1)) {\n        text = matsTypes.InputTypes.unused; //$('#' + this.name + \"-\" + this.type).select2().val(null).trigger('change');\n      }\n\n      matsParamUtils.setValueTextForParamName(event.target.name, text);\n    } catch (error) {\n      matsParamUtils.setValueTextForParamName(event.target.name, \"\");\n    }\n\n    const editMode = Session.get(\"editMode\");\n    const curveItem = editMode === undefined && editMode === \"\" ? undefined : document.getElementById(\"curveItem-\" + editMode);\n\n    if (curveItem) {\n      $('#save').trigger('click');\n    }\n\n    if (event.target.multiple) {\n      Session.set('editMode', editMode); // restore the editing of the curve item for muli selects\n\n      const controlElem = matsParamUtils.getControlElementForParamName(this.name);\n      $(controlElem).trigger('click'); // reopen the select2 - the regular open is not located properly so do it by clicking the control element button\n    }\n\n    return false;\n  }\n});","map":{"version":3,"sources":["packages/randyp:mats-common/templates/common/select.js"],"names":["matsTypes","module","link","v","matsCollections","matsParamUtils","matsSelectUtils","Template","select","onRendered","ref","data","name","type","$","select2","minimumResultsForSearch","closeOnSelect","elem","document","getElementById","addEventListener","event","paramData","CurveParams","findOne","dependentNames","peerName","refreshPeer","search","options","refresh","e","message","setError","checkHideOther","helpers","optionMaxLength","sOptions","longest","reduce","a","b","length","ret","Math","round","isSelectedByDefault","p","default","InputTypes","unused","optionsGroups","foreach","value","Soptions","concat","typeSort","multiple","isMultiple","selectionIsOptional","selectionOptional","setValue","pName","getInputElementForParamName","selectedOptions","undefined","selectedIndex","setValueTextForParamName","text","firstOption","lastOption","events","Session","set","Date","now","paramName","target","style","display","curveItem","get","scrollIntoView","refreshDependents","controlElem","getControlElementForParamName","trigger","editMode","values","i","push","val","selectOrderEnforced","defaultOption","selection","curves","priorSelected","ci","curve","curveOption","unusedOption","includes","oi","option","setCustomValidity","checkValidity","currentTarget","error"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2019 Colorado State University and Regents of the University of Colorado. All rights reserved.\n */\n\nimport { matsTypes } from 'meteor/randyp:mats-common';\nimport { matsCollections } from 'meteor/randyp:mats-common';\nimport { matsParamUtils } from 'meteor/randyp:mats-common';\nimport { matsSelectUtils } from 'meteor/randyp:mats-common';\n\n/*\n    Much of the work for select widgets happens in mats-common->imports->client->select_util.js. Especially the refresh\n    routine which sets all the options. Don't forget to look there for much of the handling.\n */\nTemplate.select.onRendered( function () {\n    const ref = this.data.name + '-' + this.data.type;\n    $(\"#\" + ref).select2({minimumResultsForSearch: 20,closeOnSelect: false});\n\n    const elem = document.getElementById(ref);\n    try {\n        // register refresh event for axis change to use to enforce a refresh\n\n        elem && elem.addEventListener('axisRefresh', function (event) {\n            // Don't know why I have to do this, I expected the parameter data to be in the context....\n            const paramData = matsCollections.CurveParams.findOne({name: this.name}, {dependentNames: 1, peerName: 1});\n            matsSelectUtils.refreshPeer(event,paramData);\n        });\n\n        // register refresh event for any superior to use to enforce a refresh of the options list\n        if (ref.search('axis') === 1) {\n            // this is a \"brother\" (hidden) scatterplot param. There is no need to refresh it or add event listeners etc.\n            return;\n        }\n        elem.options = [];\n        elem && elem.addEventListener('refresh', function (event) {\n            matsSelectUtils.refresh(event,this.name);\n        });\n    } catch (e) {\n        e.message = \"Error in select.js rendered: \" + e.message;\n        setError(e);\n    }\n    try {\n        matsSelectUtils.checkHideOther(this.data,true); // calls checkDisable\n        matsSelectUtils.refresh(null,this.data.name);\n    } catch (e) {\n        e.message = \"Error in select.js rendered function checking to hide or disable other elements: \" + e.message;\n        setError(e);\n    }\n});\n\nTemplate.select.helpers({\n    optionMaxLength: function() {\n        var sOptions = [];\n        if (!this.options) {\n            return 10;\n        }\n        const longest = (this.options).reduce(function (a, b) {\n            if (a === null && b === null) {\n                return  null;\n            }\n            if (a === null) {\n                return b;\n            }\n            if (b === null) {\n                return a;\n            }\n            return a.length > b.length ? a : b;\n        });\n        if (!longest) {\n            return 10;\n        }\n        const ret = longest.length <= 10 ? 10 : Math.round(longest.length * 0.8);\n\n        return ret;\n    },\n\n    isSelectedByDefault: function (p) {\n        if (p.default == this) {\n            return \"selected\";   // the selected option\n        } else {\n            return \"\"; // not the selected option\n        }\n    },\n    options: function () {\n        var sOptions = [];\n        //process options as an option list\n        if (this.options === matsTypes.InputTypes.unused) {\n            return [];\n        } else if (this.optionsGroups) {\n            // options have optionGroups\n            this.optionsGroups.foreach(function(value) {\n                Soptions.concat(value);\n            });\n        } else {\n            sOptions = matsParamUtils.typeSort(this.options);\n        }\n        return sOptions;\n    },\n    multiple: function () {\n        if (this.multiple === true) {\n            return \"multiple\";\n        }\n    },\n    isMultiple: function () {\n        return this.multiple === true;\n    },\n    selectionIsOptional: function () {\n        return this.selectionOptional === true;\n    }\n});\n\nconst setValue = function(pName) {\n    const elem = matsParamUtils.getInputElementForParamName(pName);\n    const selectedOptions = elem.selectedOptions;\n    const options = elem.options;\n\n    if (selectedOptions === undefined || selectedOptions.length === 0 || elem.selectedIndex === -1) {\n        // set to the default - the 0th one\n        matsParamUtils.setValueTextForParamName(pName, matsTypes.InputTypes.unused);\n    } else {\n        if (selectedOptions.length === 1) {\n            matsParamUtils.setValueTextForParamName(pName, selectedOptions[0].text);\n        } else {\n            // selected options is greater than 1 - must be a multiple\n            const firstOption = selectedOptions[0];\n            const lastOption = selectedOptions[selectedOptions.length -1];\n            const text = firstOption.text + \" .. \" + lastOption.text;\n            matsParamUtils.setValueTextForParamName(pName, text);\n        }\n    }\n}\n\n\nTemplate.select.events({\n    'change .data-input': function (event) {\n        Session.set(\"elementChanged\", Date.now());\n        const paramName =  event.target.name;\n        if (paramName === undefined) {\n            return false;\n        }\n        // These need to be done in the right order!\n        // always check to see if an \"other\" needs to be hidden or disabled before refreshing\n        matsSelectUtils.checkHideOther(this, false);\n        matsSelectUtils.refreshPeer(event, this);\n        document.getElementById(\"element-\" + this.name).style.display = \"none\"; // be sure to hide the element div\n        const curveItem = document.getElementById(\"curveItem-\" + Session.get(\"editMode\"));\n        curveItem && curveItem.scrollIntoView(false);\n        setValue(paramName);\n        if (this.multiple) {\n            return true; // prevents the select 2 from closing on multiple selectors\n        }\n        $('#' + this.name + \"-\" + this.type).select2('close');\n        matsSelectUtils.refreshDependents(event, this);\n        Session.set('lastUpdate', Date.now());\n        return false;\n    },\n    'click .doneSelecting': function (event) {\n        Session.set(\"elementChanged\", Date.now());\n        const controlElem = matsParamUtils.getControlElementForParamName(this.name);\n        $('#' + this.name + \"-\" + this.type).select2(\"close\").trigger('change'); // apply the selection choices to the select2\n        const editMode = Session.get(\"editMode\");\n        const curveItem = (editMode === undefined && editMode === \"\") ? undefined : document.getElementById(\"curveItem-\" + editMode);\n        if (curveItem) {\n            $('#save').trigger('click');\n        }\n        if (editMode) {\n            $('#' + this.name + \"-\" + this.type).select2(\"close\"); // use the close on the selector when editing\n        } else {\n            $(controlElem).trigger('click');  // clicking the control element hides the selector when not editing\n            $('#' + this.name + \"-\" + this.type).select2(\"close\");\n        }\n        return false;\n    },\n    'click .selectAll': function (event) {\n        const elem = matsParamUtils.getInputElementForParamName(this.name);\n        var values = [];\n        for (var i=0; i<elem.options.length; i++) {\n             values.push(elem.options[i].text);\n         }\n        $('#' + this.name + \"-\" + this.type).select2().val(values).trigger('change');\n        return false;\n    },\n    'click .clearSelections': function (event) {\n        const elem = matsParamUtils.getInputElementForParamName(this.name);\n        $('#' + this.name + \"-\" + this.type).select2().val(null).trigger('change');\n        return false;\n    },\n    'click .doNotUse': function (event) {\n        const elem = matsParamUtils.getInputElementForParamName(this.name);\n        $('#' + this.name + \"-\" + this.type).select2().val(null).trigger('change');\n        return false;\n    },\n    'change, blur .item' : function (event) {\n        try {\n            var text = \"\";\n            if (this.type == matsTypes.InputTypes.selectOrderEnforced) {\n                /* check the validity of the order enforcement.\n                   The requirement for order enforced selectors is that\n                   some curve must have previously selected the earlier (lower ordered)\n                   options in the options array, not counting the default option to make this a valid selection.\n                   For example if my options are... ['auto by variable','y1','y2',y3'] and 'auto by variable'\n                   is the selectors default then choosing 'y2' or 'y3' prior to choosing 'y1' is not valid and\n                   choosing 'y3' prior to choosing 'y1' and 'y2' is not valid.\n                 */\n                // what is the default?\n                var defaultOption = this.default;\n                var selection = $(event.target).val();\n                var curves = Session.get('Curves');\n                var options = this.options;\n                var priorSelected = [defaultOption];\n                for (var ci = 0; ci < curves.length; ci++) {\n                    var curve = curves[ci];\n                    var curveOption = curve[this.name];\n                    priorSelected.push(curveOption);\n                }\n                var unusedOption = \"\";\n                if (!priorSelected.includes(selection)) {\n                    // this option has not been selected prior\n                    // check to see if all the prior options to this one are selected\n                    for (var oi = 0; oi < options.length; oi++) {\n                        var option = options[oi];\n                        // We reached the selected option\n                        if (option == selection) {\n                            break;\n                        }\n                        if (!priorSelected.includes(option)) {\n                            unusedOption = option;\n                            break;\n                        }\n                    }\n                    if (unusedOption === \"\") {\n                        // is valid all prior options were selected\n                        event.target.setCustomValidity(this.name,\"\");\n                    } else {\n                        // HACK ALERT! the customValidity stuff seems to have been overridden in the invalid event event handler of item.js\n                        Session.set('errorMessage',\"The prior option: \" + unusedOption + \" was not selected for this selector, you must use that first.\")\n                        event.target.setCustomValidity(this.name,\"The prior option: \" + unusedOption + \" was not selected for this selector, you must use that first.\");\n                        event.target.checkValidity();\n//                        matsParamUtils.setInputForParamName(this.name,this.default);\n                    }\n                }\n            }\n            if (event.target.multiple) {\n                const values = $(event.target).val();\n                if (values === null) { // happens if unused or empty\n                    text = matsTypes.InputTypes.unused;\n                } else {\n                    const firstOption = values[0];\n                    const lastOption = values[values.length - 1];\n                    text = firstOption + \" .. \" + lastOption;\n                }\n            } else {\n                text = $(event.target).val();\n            }\n            if (this.type === matsTypes.InputTypes.select && (text === \"\" || text === undefined || text === null) &&\n                (this.default === -1 || this.default === undefined || this.default === null || event.currentTarget.selectedIndex == -1)) {\n                text = matsTypes.InputTypes.unused;\n                //$('#' + this.name + \"-\" + this.type).select2().val(null).trigger('change');\n            }\n            matsParamUtils.setValueTextForParamName(event.target.name, text);\n        } catch (error){\n            matsParamUtils.setValueTextForParamName(event.target.name, \"\");\n        }\n        const editMode = Session.get(\"editMode\");\n        const curveItem = (editMode === undefined && editMode === \"\") ? undefined : document.getElementById(\"curveItem-\" + editMode);\n        if (curveItem) {\n            $('#save').trigger('click');\n        }\n        if (event.target.multiple) {\n            Session.set('editMode', editMode); // restore the editing of the curve item for muli selects\n            const controlElem = matsParamUtils.getControlElementForParamName(this.name);\n            $(controlElem).trigger('click');  // reopen the select2 - the regular open is not located properly so do it by clicking the control element button\n        }\n        return false;\n    }\n});\n"]},"sourceType":"script","hash":"8861e3b3d1f785b421cc62bf182ad06be26b6702"}
