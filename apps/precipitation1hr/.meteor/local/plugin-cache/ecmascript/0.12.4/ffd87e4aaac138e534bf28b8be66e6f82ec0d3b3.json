{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/randyp:mats-common/templates/common/map.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/randyp:mats-common/templates/common/map.js","filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/randyp:mats-common/templates/common/map.js","passPerPreset":false,"envName":"development","cwd":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","root":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/randyp:mats-common/templates/common/map.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/randyp:mats-common/templates/common/map.js"}},"code":"var matsParamUtils;\nmodule.link(\"meteor/randyp:mats-common\", {\n  matsParamUtils: function (v) {\n    matsParamUtils = v;\n  }\n}, 0);\nTemplate.map.onRendered(function () {\n  var defaultAttrs = this; // save for when we need to reset to defaults\n\n  $.getScript(\"https://cdn.plot.ly/plotly-latest.min.js\", function () {\n    var targetId = '';\n    var peerName = '';\n    var markers = [];\n    var thisMarkers = [];\n    var peerOptions = [];\n    var selectedValues = [];\n    var divElement = '';\n    var divId = '';\n    var layout = {};\n    var dataset = {}; // method to initialize the map selector\n\n    var initializeSelectorMap = function (item) {\n      var defaultPoint = item.data.defaultMapView.point;\n      var defaultZoomLevel = item.data.defaultMapView.zoomLevel;\n      peerName = item.data.peerName;\n      var targetElement = document.getElementsByName(peerName)[0];\n\n      if (!targetElement) {\n        return;\n      }\n\n      targetId = '#' + targetElement.id;\n      markers = item.data.optionsMap; // from app startup\n\n      thisMarkers = []; // markers valid for this data source\n      // find out what peer options are available for this data source\n\n      peerOptions = [];\n\n      if (targetElement.options) {\n        for (var i = 0; i < targetElement.options.length; i++) {\n          peerOptions.push(targetElement.options[i].text);\n        }\n      }\n\n      selectedValues = $(targetId).val() ? $(targetId).val() : [];\n      divElement = item.data.name + '-' + item.data.type;\n      divId = '#' + divElement;\n      layout = {\n        autosize: true,\n        // height: 500,\n        // width: 840,\n        hovermode: 'closest',\n        mapbox: {\n          bearing: 0,\n          center: {\n            lat: defaultPoint[0],\n            lon: defaultPoint[1]\n          },\n          pitch: 0,\n          zoom: defaultZoomLevel,\n          accesstoken: 'pk.eyJ1IjoibWF0cy1nc2QiLCJhIjoiY2pvN2l1N2MyMG9xdTN3bWR3ODV5a2E2ZiJ9.PtgcGhxaoD43N0OwJSNVMg',\n          style: 'light'\n        },\n        margin: {\n          l: 10,\n          r: 10,\n          b: 10,\n          t: 10,\n          pad: 4\n        },\n        showlegend: false\n      };\n      dataset = {\n        label: 'sitesMap',\n        siteName: [],\n        lat: [],\n        lon: [],\n        text: [],\n        type: 'scattermapbox',\n        mode: 'markers',\n        marker: {\n          color: [],\n          opacity: 1\n        }\n      }; // set the initial site marker locations and colors\n\n      var marker;\n\n      for (var sidx = 0; sidx < peerOptions.length; sidx++) {\n        marker = markers.find(function (obj) {\n          return obj.name === peerOptions[sidx];\n        });\n        thisMarkers[sidx] = marker;\n        dataset.siteName[sidx] = marker.name;\n        dataset.text[sidx] = marker.name;\n        dataset.lat[sidx] = marker.point[0];\n        dataset.lon[sidx] = marker.point[1];\n\n        if (selectedValues.indexOf(marker.name) === -1) {\n          dataset.marker.color[sidx] = marker.options.color;\n        } else {\n          dataset.marker.color[sidx] = marker.options.highLightColor;\n        }\n      }\n    }; // call the above initialization for the first time\n\n\n    initializeSelectorMap(defaultAttrs); // draw the map for the first time\n\n    Plotly.newPlot($(divId)[0], [dataset], layout);\n    /*\n     The following lines of code are event handlers for if a user clicks on a single station, or uses the area select\n    tools to highlight a group of stations. For now, the logic is such that individual stations can toggle between\n    chosen and unchosen by clicking them, but the area select tools will just choose everything that is outlined.\n    This is so that if a user has been manually choosing stations and then gives up and uses the area select, all of\n    their intended stations will be chosen (the ones they had already manually selected won't be unchosen). There will\n    be some sort of 'deselect all' button on this modal to unchoose everything.\n     NOTE: We are using plotly's event handlers here, but we are not using its native chosen/unchosen capabilities.\n    Instead, we are getting the chosen values back from the area select and adding them into out own arrays. We then\n    finish by telling plotly to deselect everything in its own internal accounting. There are two reasons for this:\n        1) plotly's ways of handling chosen/unchosen values are way more complicated than is needed here\n        2) under plotly's system, if we use the area select once, we then can't go back and add other areas or\n        individual stations without losing the original selection.\n     However, we may want to explore plotly's native chosen/unchosen capabilities in the future for our process-oriented\n    verification.\n     --MBS, 11/13/18\n      */\n    // event handler for clicking individual stations\n\n    $(divId)[0].on('plotly_click', function (eventdata) {\n      //get index of current station\n      var currPoint = eventdata.points[0].pointNumber;\n\n      if (dataset.marker.color[currPoint] === thisMarkers[currPoint].options.color) {\n        // switch to selected color and add this station to our selected values array\n        dataset.marker.color[currPoint] = thisMarkers[currPoint].options.highLightColor;\n        selectedValues.push(eventdata.points[0].text);\n      } else {\n        // switch to deselected color and remove this station from our selected values array\n        dataset.marker.color[currPoint] = thisMarkers[currPoint].options.color;\n        var tidx = selectedValues.indexOf(eventdata.points[0].text);\n\n        if (tidx > -1) {\n          selectedValues.splice(tidx, 1);\n        }\n      } // update the marker color on the plot and the values in the site selector\n\n\n      var update = {\n        'marker': {\n          color: dataset.marker.color,\n          opacity: 1\n        }\n      };\n      Plotly.restyle($(divId)[0], update, eventdata.points[0].curveNumber);\n      $(targetId).val(selectedValues).trigger(\"change\");\n      matsParamUtils.collapseParam(peerName);\n      $(targetId).select2(\"close\");\n    }); // event handler for outlining multiple stations\n\n    $(divId)[0].on('plotly_selected', function (eventdata) {\n      if (eventdata === undefined || eventdata.points.length < 1) {\n        // the user has clicked outside of the select area, so make sure plotly's area select is disabled.\n        // otherwise the user won't be able to choose individual stations after choosing an area select\n        $(divId + \" .select-outline\").remove();\n        Plotly.restyle($(divId)[0], {\n          selectedpoints: [null]\n        });\n      } else {\n        // the user has selected all the points in an area. Iterate through them and select any that are not already selected.\n        var currPoint;\n        eventdata.points.forEach(function (pt) {\n          currPoint = pt.pointNumber;\n\n          if (dataset.marker.color[currPoint] === thisMarkers[currPoint].options.color) {\n            // switch to selected color and add this station to our selected values array\n            dataset.marker.color[currPoint] = thisMarkers[currPoint].options.highLightColor;\n            selectedValues.push(pt.text);\n          }\n        }); // update the marker color on the plot and the values in the site selector\n\n        var update = {\n          'marker': {\n            color: dataset.marker.color,\n            opacity: 1\n          }\n        };\n        Plotly.restyle($(divId)[0], update, eventdata.points[0].curveNumber);\n        $(targetId).val(selectedValues).trigger(\"change\");\n        matsParamUtils.collapseParam(peerName);\n        $(targetId).select2(\"close\"); // As per the comment block above, we're done here, so make sure plotly's area select is disabled.\n        // otherwise the user won't be able to choose individual stations after choosing an area select.\n\n        $(divId + \" .select-outline\").remove();\n        Plotly.restyle($(divId)[0], {\n          selectedpoints: [null]\n        });\n      }\n    }); // event handler for selecting all stations\n\n    $('.selectSites').on('click', function () {\n      event.preventDefault(); // fill the selected values array with all available options and change the marker to its highlight color\n\n      $(targetId).val(peerOptions).trigger(\"change\");\n      matsParamUtils.collapseParam(peerName);\n      $(targetId).select2(\"close\");\n\n      for (var sidx = 0; sidx < thisMarkers.length; sidx++) {\n        dataset.marker.color[sidx] = thisMarkers[sidx].options.highLightColor;\n      }\n\n      var update = {\n        'marker': {\n          color: dataset.marker.color,\n          opacity: 1\n        }\n      };\n      Plotly.restyle($(divId)[0], update, [0]);\n    }); // event handler for deselecting all stations\n\n    $('.deselectSites').on('click', function () {\n      event.preventDefault(); // empty the selected values array and return the marker to its original color\n\n      $(targetId).val([]).trigger(\"change\");\n      matsParamUtils.collapseParam(peerName);\n      $(targetId).select2(\"close\");\n\n      for (var sidx = 0; sidx < thisMarkers.length; sidx++) {\n        dataset.marker.color[sidx] = thisMarkers[sidx].options.color;\n      }\n\n      var update = {\n        'marker': {\n          color: dataset.marker.color,\n          opacity: 1\n        }\n      };\n      Plotly.restyle($(divId)[0], update, [0]);\n    }); // method to see if the available sites have changed for this data source\n\n    var refreshOptionsForPeer = function (peerElement) {\n      // find out what peer options are available\n      peerOptions = [];\n\n      if (peerElement.options) {\n        for (var i = 0; i < peerElement.options.length; i++) {\n          peerOptions.push(peerElement.options[i].text);\n        }\n      }\n    }; // method to sync the map up with the sites selector\n\n\n    var refresh = function (peerElement) {\n      if (!peerElement) {\n        return;\n      }\n\n      var peerId = peerElement.id;\n      refreshOptionsForPeer(peerElement);\n      selectedValues = $('#' + peerId).val() ? $('#' + peerId).val() : []; // need to redo these in case the available sites have changed for this data source\n\n      thisMarkers = [];\n      dataset.siteName = [];\n      dataset.text = [];\n      dataset.lat = [];\n      dataset.lon = [];\n      dataset.marker.color = [];\n      var marker;\n\n      for (var sidx = 0; sidx < peerOptions.length; sidx++) {\n        marker = markers.find(function (obj) {\n          return obj.name === peerOptions[sidx];\n        });\n        thisMarkers[sidx] = marker;\n        dataset.siteName[sidx] = marker.name;\n        dataset.text[sidx] = marker.name;\n        dataset.lat[sidx] = marker.point[0];\n        dataset.lon[sidx] = marker.point[1];\n\n        if (selectedValues.indexOf(marker.name) === -1) {\n          dataset.marker.color[sidx] = marker.options.color;\n        } else {\n          dataset.marker.color[sidx] = marker.options.highLightColor;\n        }\n      }\n\n      $(divId)[0].data[0] = dataset;\n      Plotly.redraw($(divId)[0]);\n    }; // method to reset the map to defaults\n\n\n    var resetMap = function (item) {\n      initializeSelectorMap(item);\n      $(divId)[0].data[0] = dataset;\n      $(divId)[0].layout = layout;\n      Plotly.redraw($(divId)[0]);\n    }; // register an event listener so that the select.js can ask the map div to refresh after a selection\n\n\n    var elem = document.getElementById(divElement);\n    elem.addEventListener('refresh', function (e) {\n      refresh(e.detail.refElement);\n    }); // register an event listener so that the param_util.js can ask the map div to reset when someone clicks 'reset to defaults'\n\n    elem = document.getElementById(divElement);\n    elem.addEventListener('reset', function (e) {\n      resetMap(defaultAttrs);\n    });\n  });\n});","map":{"version":3,"sources":["packages/randyp:mats-common/templates/common/map.js"],"names":["matsParamUtils","module","link","v","Template","map","onRendered","defaultAttrs","$","getScript","targetId","peerName","markers","thisMarkers","peerOptions","selectedValues","divElement","divId","layout","dataset","initializeSelectorMap","item","defaultPoint","data","defaultMapView","point","defaultZoomLevel","zoomLevel","targetElement","document","getElementsByName","id","optionsMap","options","i","length","push","text","val","name","type","autosize","hovermode","mapbox","bearing","center","lat","lon","pitch","zoom","accesstoken","style","margin","l","r","b","t","pad","showlegend","label","siteName","mode","marker","color","opacity","sidx","find","obj","indexOf","highLightColor","Plotly","newPlot","on","eventdata","currPoint","points","pointNumber","tidx","splice","update","restyle","curveNumber","trigger","collapseParam","select2","undefined","remove","selectedpoints","forEach","pt","event","preventDefault","refreshOptionsForPeer","peerElement","refresh","peerId","redraw","resetMap","elem","getElementById","addEventListener","e","detail","refElement"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2019 Colorado State University and Regents of the University of Colorado. All rights reserved.\n */\n\nimport {matsParamUtils} from 'meteor/randyp:mats-common';\n\nTemplate.map.onRendered(function () {\n\n    var defaultAttrs = this;    // save for when we need to reset to defaults\n\n    $.getScript(\"https://cdn.plot.ly/plotly-latest.min.js\", function () {\n        var targetId = '';\n        var peerName = '';\n        var markers = [];\n        var thisMarkers = [];\n        var peerOptions = [];\n        var selectedValues = [];\n        var divElement = '';\n        var divId = '';\n        var layout = {};\n        var dataset = {};\n\n        // method to initialize the map selector\n        var initializeSelectorMap = function (item) {\n            var defaultPoint = item.data.defaultMapView.point;\n            var defaultZoomLevel = item.data.defaultMapView.zoomLevel;\n            peerName = item.data.peerName;\n\n            var targetElement = document.getElementsByName(peerName)[0];\n            if (!targetElement) {\n                return;\n            }\n            targetId = '#' + targetElement.id;\n\n            markers = item.data.optionsMap;   // from app startup\n            thisMarkers = [];       // markers valid for this data source\n\n            // find out what peer options are available for this data source\n            peerOptions = [];\n            if (targetElement.options) {\n                for (var i = 0; i < targetElement.options.length; i++) {\n                    peerOptions.push(targetElement.options[i].text);\n                }\n            }\n            selectedValues = $(targetId).val() ? $(targetId).val() : [];\n\n            divElement = item.data.name + '-' + item.data.type;\n            divId = '#' + divElement;\n\n            layout = {\n                autosize: true,\n                // height: 500,\n                // width: 840,\n                hovermode: 'closest',\n                mapbox: {\n                    bearing: 0,\n                    center: {\n                        lat: defaultPoint[0],\n                        lon: defaultPoint[1]\n                    },\n                    pitch: 0,\n                    zoom: defaultZoomLevel,\n                    accesstoken: 'pk.eyJ1IjoibWF0cy1nc2QiLCJhIjoiY2pvN2l1N2MyMG9xdTN3bWR3ODV5a2E2ZiJ9.PtgcGhxaoD43N0OwJSNVMg',\n                    style: 'light'\n                },\n                margin: {\n                    l: 10,\n                    r: 10,\n                    b: 10,\n                    t: 10,\n                    pad: 4\n                },\n                showlegend: false,\n            };\n\n            dataset = {\n                label: 'sitesMap',\n                siteName: [],\n                lat: [],\n                lon: [],\n                text: [],\n                type: 'scattermapbox',\n                mode: 'markers',\n                marker: {\n                    color: [],\n                    opacity: 1\n                }\n            };\n\n            // set the initial site marker locations and colors\n            var marker;\n            for (var sidx = 0; sidx < peerOptions.length; sidx++) {\n                marker = markers.find(obj => {\n                    return obj.name === peerOptions[sidx];\n                });\n                thisMarkers[sidx] = marker;\n                dataset.siteName[sidx] = marker.name;\n                dataset.text[sidx] = marker.name;\n                dataset.lat[sidx] = marker.point[0];\n                dataset.lon[sidx] = marker.point[1];\n                if (selectedValues.indexOf(marker.name) === -1) {\n                    dataset.marker.color[sidx] = marker.options.color;\n                } else {\n                    dataset.marker.color[sidx] = marker.options.highLightColor;\n                }\n            }\n        };\n\n        // call the above initialization for the first time\n        initializeSelectorMap(defaultAttrs);\n\n        // draw the map for the first time\n        Plotly.newPlot($(divId)[0], [dataset], layout);\n\n        /*\n\n        The following lines of code are event handlers for if a user clicks on a single station, or uses the area select\n        tools to highlight a group of stations. For now, the logic is such that individual stations can toggle between\n        chosen and unchosen by clicking them, but the area select tools will just choose everything that is outlined.\n        This is so that if a user has been manually choosing stations and then gives up and uses the area select, all of\n        their intended stations will be chosen (the ones they had already manually selected won't be unchosen). There will\n        be some sort of 'deselect all' button on this modal to unchoose everything.\n\n        NOTE: We are using plotly's event handlers here, but we are not using its native chosen/unchosen capabilities.\n        Instead, we are getting the chosen values back from the area select and adding them into out own arrays. We then\n        finish by telling plotly to deselect everything in its own internal accounting. There are two reasons for this:\n            1) plotly's ways of handling chosen/unchosen values are way more complicated than is needed here\n            2) under plotly's system, if we use the area select once, we then can't go back and add other areas or\n            individual stations without losing the original selection.\n\n        However, we may want to explore plotly's native chosen/unchosen capabilities in the future for our process-oriented\n        verification.\n\n        --MBS, 11/13/18\n\n         */\n\n        // event handler for clicking individual stations\n        $(divId)[0].on('plotly_click', function (eventdata) {\n            //get index of current station\n            const currPoint = eventdata.points[0].pointNumber;\n            if (dataset.marker.color[currPoint] === thisMarkers[currPoint].options.color) {\n                // switch to selected color and add this station to our selected values array\n                dataset.marker.color[currPoint] = thisMarkers[currPoint].options.highLightColor;\n                selectedValues.push(eventdata.points[0].text);\n            } else {\n                // switch to deselected color and remove this station from our selected values array\n                dataset.marker.color[currPoint] = thisMarkers[currPoint].options.color;\n                var tidx = selectedValues.indexOf(eventdata.points[0].text);\n                if (tidx > -1) {\n                    selectedValues.splice(tidx, 1);\n                }\n            }\n            // update the marker color on the plot and the values in the site selector\n            var update = {'marker': {color: dataset.marker.color, opacity: 1}};\n            Plotly.restyle($(divId)[0], update, eventdata.points[0].curveNumber);\n            $(targetId).val(selectedValues).trigger(\"change\");\n            matsParamUtils.collapseParam(peerName);\n            $(targetId).select2(\"close\");\n        });\n\n        // event handler for outlining multiple stations\n        $(divId)[0].on('plotly_selected', function (eventdata) {\n            if (eventdata === undefined || (eventdata.points.length < 1)) {\n                // the user has clicked outside of the select area, so make sure plotly's area select is disabled.\n                // otherwise the user won't be able to choose individual stations after choosing an area select\n                $(divId + \" .select-outline\").remove();\n                Plotly.restyle($(divId)[0], {selectedpoints: [null]});\n            } else {\n                // the user has selected all the points in an area. Iterate through them and select any that are not already selected.\n                var currPoint;\n                eventdata.points.forEach(function (pt) {\n                    currPoint = pt.pointNumber;\n                    if (dataset.marker.color[currPoint] === thisMarkers[currPoint].options.color) {\n                        // switch to selected color and add this station to our selected values array\n                        dataset.marker.color[currPoint] = thisMarkers[currPoint].options.highLightColor;\n                        selectedValues.push(pt.text);\n                    }\n                });\n                // update the marker color on the plot and the values in the site selector\n                var update = {'marker': {color: dataset.marker.color, opacity: 1}};\n                Plotly.restyle($(divId)[0], update, eventdata.points[0].curveNumber);\n                $(targetId).val(selectedValues).trigger(\"change\");\n                matsParamUtils.collapseParam(peerName);\n                $(targetId).select2(\"close\");\n\n                // As per the comment block above, we're done here, so make sure plotly's area select is disabled.\n                // otherwise the user won't be able to choose individual stations after choosing an area select.\n                $(divId + \" .select-outline\").remove();\n                Plotly.restyle($(divId)[0], {selectedpoints: [null]});\n            }\n        });\n\n        // event handler for selecting all stations\n        $('.selectSites').on('click', function () {\n            event.preventDefault();\n            // fill the selected values array with all available options and change the marker to its highlight color\n            $(targetId).val(peerOptions).trigger(\"change\");\n            matsParamUtils.collapseParam(peerName);\n            $(targetId).select2(\"close\");\n            for (var sidx = 0; sidx < thisMarkers.length; sidx++) {\n                dataset.marker.color[sidx] = thisMarkers[sidx].options.highLightColor;\n            }\n            var update = {'marker': {color: dataset.marker.color, opacity: 1}};\n            Plotly.restyle($(divId)[0], update, [0]);\n        });\n\n        // event handler for deselecting all stations\n        $('.deselectSites').on('click', function () {\n            event.preventDefault();\n            // empty the selected values array and return the marker to its original color\n            $(targetId).val([]).trigger(\"change\");\n            matsParamUtils.collapseParam(peerName);\n            $(targetId).select2(\"close\");\n            for (var sidx = 0; sidx < thisMarkers.length; sidx++) {\n                dataset.marker.color[sidx] = thisMarkers[sidx].options.color;\n            }\n            var update = {'marker': {color: dataset.marker.color, opacity: 1}};\n            Plotly.restyle($(divId)[0], update, [0]);\n        });\n\n        // method to see if the available sites have changed for this data source\n        var refreshOptionsForPeer = function (peerElement) {\n            // find out what peer options are available\n            peerOptions = [];\n            if (peerElement.options) {\n                for (var i = 0; i < peerElement.options.length; i++) {\n                    peerOptions.push(peerElement.options[i].text);\n                }\n            }\n        };\n\n        // method to sync the map up with the sites selector\n        var refresh = function (peerElement) {\n            if (!peerElement) {\n                return;\n            }\n            var peerId = peerElement.id;\n            refreshOptionsForPeer(peerElement);\n            selectedValues = $('#' + peerId).val() ? $('#' + peerId).val() : [];\n\n            // need to redo these in case the available sites have changed for this data source\n            thisMarkers = [];\n            dataset.siteName = [];\n            dataset.text = [];\n            dataset.lat = [];\n            dataset.lon = [];\n            dataset.marker.color = [];\n            var marker;\n            for (var sidx = 0; sidx < peerOptions.length; sidx++) {\n                marker = markers.find(obj => {\n                    return obj.name === peerOptions[sidx];\n                });\n                thisMarkers[sidx] = marker;\n                dataset.siteName[sidx] = marker.name;\n                dataset.text[sidx] = marker.name;\n                dataset.lat[sidx] = marker.point[0];\n                dataset.lon[sidx] = marker.point[1];\n                if (selectedValues.indexOf(marker.name) === -1) {\n                    dataset.marker.color[sidx] = marker.options.color;\n                } else {\n                    dataset.marker.color[sidx] = marker.options.highLightColor;\n                }\n            }\n            $(divId)[0].data[0] = dataset;\n            Plotly.redraw($(divId)[0]);\n        };\n\n        // method to reset the map to defaults\n        var resetMap = function (item) {\n            initializeSelectorMap(item);\n            $(divId)[0].data[0] = dataset;\n            $(divId)[0].layout = layout;\n            Plotly.redraw($(divId)[0]);\n        };\n\n        // register an event listener so that the select.js can ask the map div to refresh after a selection\n        var elem = document.getElementById(divElement);\n        elem.addEventListener('refresh', function (e) {\n            refresh(e.detail.refElement);\n        });\n\n        // register an event listener so that the param_util.js can ask the map div to reset when someone clicks 'reset to defaults'\n        elem = document.getElementById(divElement);\n        elem.addEventListener('reset', function (e) {\n            resetMap(defaultAttrs);\n        });\n\n    });\n});"]},"sourceType":"script","hash":"ffd87e4aaac138e534bf28b8be66e6f82ec0d3b3"}
