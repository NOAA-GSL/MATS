{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/route.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ostrio:flow-router-extra/client/route.js","filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/route.js","passPerPreset":false,"envName":"development","cwd":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","root":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/Users/jeffrey.a.hamilton/WebstormProjects/MATS_for_EMB/apps/precipitation1hr/packages/ostrio:flow-router-extra/client/route.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:flow-router-extra/client/route.js"}},"code":"let Router;\nmodule.link(\"./_init.js\", {\n  Router(v) {\n    Router = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet Promise;\nmodule.link(\"meteor/promise\", {\n  Promise(v) {\n    Promise = v;\n  }\n\n}, 2);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 3);\n\nlet _helpers;\n\nmodule.link(\"./../lib/_helpers.js\", {\n  _helpers(v) {\n    _helpers = v;\n  }\n\n}, 4);\nlet ReactiveDict;\nmodule.link(\"meteor/reactive-dict\", {\n  ReactiveDict(v) {\n    ReactiveDict = v;\n  }\n\n}, 5);\n\nconst makeTriggers = triggers => {\n  if (_helpers.isFunction(triggers)) {\n    return [triggers];\n  } else if (!_helpers.isArray(triggers)) {\n    return [];\n  }\n\n  return triggers;\n};\n\nclass Route {\n  constructor() {\n    let router = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Router();\n    let pathDef = arguments.length > 1 ? arguments[1] : undefined;\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    let group = arguments.length > 3 ? arguments[3] : undefined;\n    this.render = router.Renderer.render.bind(router.Renderer);\n    this.options = options;\n    this.globals = router.globals;\n    this.pathDef = pathDef; // Route.path is deprecated and will be removed in 3.0\n\n    this.path = pathDef;\n    this.conf = options.conf || {};\n    this.group = group;\n    this._data = options.data || null;\n    this._router = router;\n    this._action = options.action || Function.prototype;\n    this._waitOn = options.waitOn || null;\n    this._waitFor = _helpers.isArray(options.waitFor) ? options.waitFor : [];\n    this._subsMap = {};\n    this._onNoData = options.onNoData || null;\n    this._endWaiting = options.endWaiting || null;\n    this._currentData = null;\n    this._triggersExit = options.triggersExit ? makeTriggers(options.triggersExit) : [];\n    this._whileWaiting = options.whileWaiting || null;\n    this._triggersEnter = options.triggersEnter ? makeTriggers(options.triggersEnter) : [];\n    this._subscriptions = options.subscriptions || Function.prototype;\n    this._waitOnResources = options.waitOnResources || null;\n    this._params = new ReactiveDict();\n    this._queryParams = new ReactiveDict();\n    this._routeCloseDep = new Tracker.Dependency();\n    this._pathChangeDep = new Tracker.Dependency();\n\n    if (options.name) {\n      this.name = options.name;\n    }\n  }\n\n  clearSubscriptions() {\n    this._subsMap = {};\n  }\n\n  register(name, sub) {\n    this._subsMap[name] = sub;\n  }\n\n  getSubscription(name) {\n    return this._subsMap[name];\n  }\n\n  getAllSubscriptions() {\n    return this._subsMap;\n  }\n\n  checkSubscriptions(subscriptions) {\n    const results = [];\n\n    for (let i = 0; i < subscriptions.length; i++) {\n      results.push(subscriptions[i] && subscriptions[i].ready ? subscriptions[i].ready() : false);\n    }\n\n    return !results.includes(false);\n  }\n\n  waitOn() {\n    let current = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let next = arguments.length > 1 ? arguments[1] : undefined;\n    let _data = null;\n    let _isWaiting = false;\n    let _preloaded = 0;\n    let _resources = false;\n    let waitFor = [];\n    let promises = [];\n    let subscriptions = [];\n    let timer;\n    let trackers = [];\n\n    const placeIn = d => {\n      if (Object.prototype.toString.call(d) === '[object Promise]' || d.then && Object.prototype.toString.call(d.then) === '[object Function]') {\n        promises.push(d);\n      } else if (d.flush) {\n        trackers.push(d);\n      } else if (d.ready) {\n        subscriptions.push(d);\n      }\n    };\n\n    const whileWaitingAction = () => {\n      if (!_isWaiting) {\n        this._whileWaiting && this._whileWaiting(current.params, current.queryParams);\n        _isWaiting = true;\n      }\n    };\n\n    const subWait = delay => {\n      timer = Meteor.setTimeout(() => {\n        if (this.checkSubscriptions(subscriptions)) {\n          Meteor.clearTimeout(timer);\n          _data = getData();\n\n          if (_resources) {\n            whileWaitingAction();\n            getResources();\n          } else {\n            next(current, _data);\n          }\n        } else {\n          wait(25);\n        }\n      }, delay);\n    };\n\n    const wait = delay => {\n      if (promises.length) {\n        Promise.all(promises).then(() => {\n          subWait(delay);\n          promises = [];\n        }).catch(error => {\n          Meteor._debug('[ostrio:flow-router-extra] [route.wait] Promise not resolved', error);\n        });\n      } else {\n        subWait(delay);\n      }\n    };\n\n    const processSubData = subData => {\n      if (subData instanceof Array) {\n        for (let i = subData.length - 1; i >= 0; i--) {\n          if (subData[i] !== null && typeof subData[i] === 'object') {\n            placeIn(subData[i]);\n          }\n        }\n      } else if (subData !== null && typeof subData === 'object') {\n        placeIn(subData);\n      }\n    };\n\n    const stopSubs = () => {\n      for (let i = subscriptions.length - 1; i >= 0; i--) {\n        if (subscriptions[i].stop) {\n          subscriptions[i].stop();\n        }\n\n        delete subscriptions[i];\n      }\n\n      subscriptions = [];\n    };\n\n    const done = subscription => {\n      processSubData(_helpers.isFunction(subscription) ? subscription() : subscription);\n    };\n\n    if (current.route.globals.length) {\n      for (let i = 0; i < current.route.globals.length; i++) {\n        if (typeof current.route.globals[i] === 'object') {\n          if (current.route.globals[i].waitOnResources) {\n            if (!_resources) {\n              _resources = [];\n            }\n\n            _resources.push(current.route.globals[i].waitOnResources);\n          }\n\n          if (current.route.globals[i].waitOn && _helpers.isFunction(current.route.globals[i].waitOn)) {\n            waitFor.unshift(current.route.globals[i].waitOn);\n          }\n        }\n      }\n    }\n\n    if (this._waitOnResources) {\n      if (!_resources) {\n        _resources = [];\n      }\n\n      _resources.push(this._waitOnResources);\n    }\n\n    const preload = (len, __data) => {\n      _preloaded++;\n\n      if (_preloaded >= len) {\n        next(current, __data);\n      }\n    };\n\n    const getData = () => {\n      if (this._data) {\n        if (!_data) {\n          _data = this._currentData = this._data(current.params, current.queryParams);\n        } else {\n          _data = this._currentData;\n        }\n      }\n\n      return _data;\n    };\n\n    const getResources = () => {\n      _data = getData();\n      let len = 0;\n      let items;\n      let images = [];\n      let other = [];\n\n      for (let i = _resources.length - 1; i >= 0; i--) {\n        items = _resources[i].call(this, current.params, current.queryParams, _data);\n\n        if (items) {\n          if (items.images && items.images.length) {\n            images = images.concat(items.images);\n          }\n\n          if (items.other && items.other.length) {\n            other = other.concat(items.other);\n          }\n        }\n      }\n\n      if (other && other.length || images && images.length) {\n        if (other && other.length && typeof XMLHttpRequest !== 'undefined') {\n          other = other.filter((elem, index, self) => {\n            return index === self.indexOf(elem);\n          });\n          len += other.length;\n          const prefetch = {};\n\n          for (let k = other.length - 1; k >= 0; k--) {\n            prefetch[k] = new XMLHttpRequest();\n\n            prefetch[k].onload = () => {\n              preload(len, _data);\n            };\n\n            prefetch[k].onerror = () => {\n              preload(len, _data);\n            };\n\n            prefetch[k].open('GET', other[k]);\n            prefetch[k].send(null);\n          }\n        }\n\n        if (images && images.length) {\n          images = images.filter((elem, index, self) => {\n            return index === self.indexOf(elem);\n          });\n          len += images.length;\n          const imgs = {};\n\n          for (let j = images.length - 1; j >= 0; j--) {\n            imgs[j] = new Image();\n\n            imgs[j].onload = () => {\n              preload(len, _data);\n            };\n\n            imgs[j].onerror = () => {\n              preload(len, _data);\n            };\n\n            imgs[j].src = images[j];\n          }\n        }\n      } else {\n        next(current, _data);\n      }\n    };\n\n    if (this._waitFor.length) {\n      waitFor = waitFor.concat(this._waitFor);\n    }\n\n    if (_helpers.isFunction(this._waitOn)) {\n      waitFor.push(this._waitOn);\n    }\n\n    if (waitFor.length) {\n      waitFor.forEach(wo => {\n        processSubData(wo.call(this, current.params, current.queryParams, done));\n      });\n\n      let triggerExitIndex = this._triggersExit.push(() => {\n        stopSubs();\n\n        for (let i = trackers.length - 1; i >= 0; i--) {\n          if (trackers[i].stop) {\n            trackers[i].stop();\n          }\n\n          delete trackers[i];\n        }\n\n        trackers = [];\n        promises = [];\n        subscriptions = [];\n        _data = this._currentData = null;\n\n        this._triggersExit.splice(triggerExitIndex - 1, 1);\n      });\n\n      whileWaitingAction();\n      wait(0);\n    } else if (_resources) {\n      whileWaitingAction();\n      getResources();\n    } else if (this._data) {\n      next(current, getData());\n    } else {\n      next(current);\n    }\n  }\n\n  callAction(current) {\n    if (this._data) {\n      if (this._onNoData && !this._currentData) {\n        this._endWaiting && this._endWaiting();\n\n        this._onNoData(current.params, current.queryParams);\n      } else {\n        this._endWaiting && this._endWaiting();\n\n        this._action(current.params, current.queryParams, this._currentData);\n      }\n    } else {\n      this._endWaiting && this._endWaiting();\n\n      this._action(current.params, current.queryParams, this._currentData);\n    }\n  }\n\n  callSubscriptions(current) {\n    this.clearSubscriptions();\n\n    if (this.group) {\n      this.group.callSubscriptions(current);\n    }\n\n    this._subscriptions(current.params, current.queryParams);\n  }\n\n  getRouteName() {\n    this._routeCloseDep.depend();\n\n    return this.name;\n  }\n\n  getParam(key) {\n    this._routeCloseDep.depend();\n\n    return this._params.get(key);\n  }\n\n  getQueryParam(key) {\n    this._routeCloseDep.depend();\n\n    return this._queryParams.get(key);\n  }\n\n  watchPathChange() {\n    this._pathChangeDep.depend();\n  }\n\n  registerRouteClose() {\n    this._params = new ReactiveDict();\n    this._queryParams = new ReactiveDict();\n\n    this._routeCloseDep.changed();\n\n    this._pathChangeDep.changed();\n  }\n\n  registerRouteChange(currentContext, routeChanging) {\n    // register params\n    this._updateReactiveDict(this._params, currentContext.params); // register query params\n\n\n    this._updateReactiveDict(this._queryParams, currentContext.queryParams); // if the route is changing, we need to defer triggering path changing\n    // if we did this, old route's path watchers will detect this\n    // Real issue is, above watcher will get removed with the new route\n    // So, we don't need to trigger it now\n    // We are doing it on the route close event. So, if they exists they'll\n    // get notify that\n\n\n    if (!routeChanging) {\n      this._pathChangeDep.changed();\n    }\n  }\n\n  _updateReactiveDict(dict, newValues) {\n    const currentKeys = Object.keys(newValues);\n    const oldKeys = Object.keys(dict.keyDeps); // set new values\n    //  params is an array. So, currentKeys.forEach() does not works\n    //  to iterate params\n\n    currentKeys.forEach(key => {\n      dict.set(key, newValues[key]);\n    }); // remove keys which does not exisits here\n\n    oldKeys.filter(i => {\n      return currentKeys.indexOf(i) < 0;\n    }).forEach(key => {\n      dict.set(key, undefined);\n    });\n  }\n\n}\n\nmodule.exportDefault(Route);","map":{"version":3,"sources":["packages/ostrio:flow-router-extra/client/route.js"],"names":["Router","module","link","v","Meteor","Promise","Tracker","_helpers","ReactiveDict","makeTriggers","triggers","isFunction","isArray","Route","constructor","router","pathDef","options","group","render","Renderer","bind","globals","path","conf","_data","data","_router","_action","action","Function","prototype","_waitOn","waitOn","_waitFor","waitFor","_subsMap","_onNoData","onNoData","_endWaiting","endWaiting","_currentData","_triggersExit","triggersExit","_whileWaiting","whileWaiting","_triggersEnter","triggersEnter","_subscriptions","subscriptions","_waitOnResources","waitOnResources","_params","_queryParams","_routeCloseDep","Dependency","_pathChangeDep","name","clearSubscriptions","register","sub","getSubscription","getAllSubscriptions","checkSubscriptions","results","i","length","push","ready","includes","current","next","_isWaiting","_preloaded","_resources","promises","timer","trackers","placeIn","d","Object","toString","call","then","flush","whileWaitingAction","params","queryParams","subWait","delay","setTimeout","clearTimeout","getData","getResources","wait","all","catch","error","_debug","processSubData","subData","Array","stopSubs","stop","done","subscription","route","unshift","preload","len","__data","items","images","other","concat","XMLHttpRequest","filter","elem","index","self","indexOf","prefetch","k","onload","onerror","open","send","imgs","j","Image","src","forEach","wo","triggerExitIndex","splice","callAction","callSubscriptions","getRouteName","depend","getParam","key","get","getQueryParam","watchPathChange","registerRouteClose","changed","registerRouteChange","currentContext","routeChanging","_updateReactiveDict","dict","newValues","currentKeys","keys","oldKeys","keyDeps","set","undefined","exportDefault"],"mappings":"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","sourcesContent":["import { Router }       from './_init.js';\nimport { Meteor }       from 'meteor/meteor';\nimport { Promise }      from 'meteor/promise';\nimport { Tracker }      from 'meteor/tracker';\nimport { _helpers }     from './../lib/_helpers.js';\nimport { ReactiveDict } from 'meteor/reactive-dict';\n\nconst makeTriggers = (triggers) => {\n  if (_helpers.isFunction(triggers)) {\n    return [triggers];\n  } else if (!_helpers.isArray(triggers)) {\n    return [];\n  }\n\n  return triggers;\n};\n\nclass Route {\n  constructor(router = new Router(), pathDef, options = {}, group) {\n    this.render           = router.Renderer.render.bind(router.Renderer);\n    this.options          = options;\n    this.globals          = router.globals;\n    this.pathDef          = pathDef;\n\n    // Route.path is deprecated and will be removed in 3.0\n    this.path             = pathDef;\n    this.conf             = options.conf || {};\n    this.group            = group;\n    this._data            = options.data || null;\n    this._router          = router;\n    this._action          = options.action || Function.prototype;\n    this._waitOn          = options.waitOn || null;\n    this._waitFor         = _helpers.isArray(options.waitFor) ? options.waitFor : [];\n    this._subsMap         = {};\n    this._onNoData        = options.onNoData || null;\n    this._endWaiting      = options.endWaiting || null;\n    this._currentData     = null;\n    this._triggersExit    = options.triggersExit ? makeTriggers(options.triggersExit) : [];\n    this._whileWaiting    = options.whileWaiting || null;\n    this._triggersEnter   = options.triggersEnter ? makeTriggers(options.triggersEnter) : [];\n    this._subscriptions   = options.subscriptions || Function.prototype;\n    this._waitOnResources = options.waitOnResources || null;\n\n    this._params          = new ReactiveDict();\n    this._queryParams     = new ReactiveDict();\n    this._routeCloseDep   = new Tracker.Dependency();\n    this._pathChangeDep   = new Tracker.Dependency();\n\n    if (options.name) {\n      this.name = options.name;\n    }\n  }\n\n  clearSubscriptions() {\n    this._subsMap = {};\n  }\n\n  register(name, sub) {\n    this._subsMap[name] = sub;\n  }\n\n  getSubscription(name) {\n    return this._subsMap[name];\n  }\n\n  getAllSubscriptions() {\n    return this._subsMap;\n  }\n\n  checkSubscriptions(subscriptions) {\n    const results = [];\n    for (let i = 0; i < subscriptions.length; i++) {\n      results.push((subscriptions[i] && subscriptions[i].ready) ? subscriptions[i].ready() : false);\n    }\n\n    return !results.includes(false);\n  }\n\n  waitOn(current = {}, next) {\n    let _data         = null;\n    let _isWaiting    = false;\n    let _preloaded    = 0;\n    let _resources    = false;\n    let waitFor       = [];\n    let promises      = [];\n    let subscriptions = [];\n    let timer;\n    let trackers      = [];\n\n    const placeIn = (d) => {\n      if (Object.prototype.toString.call(d) === '[object Promise]' || d.then && Object.prototype.toString.call(d.then) === '[object Function]') {\n        promises.push(d);\n      } else if (d.flush) {\n        trackers.push(d);\n      } else if (d.ready) {\n        subscriptions.push(d);\n      }\n    };\n\n    const whileWaitingAction = () => {\n      if (!_isWaiting) {\n        this._whileWaiting && this._whileWaiting(current.params, current.queryParams);\n        _isWaiting = true;\n      }\n    };\n\n    const subWait = (delay) => {\n      timer = Meteor.setTimeout(() => {\n        if (this.checkSubscriptions(subscriptions)) {\n          Meteor.clearTimeout(timer);\n          _data = getData();\n          if (_resources) {\n            whileWaitingAction();\n            getResources();\n          } else {\n            next(current, _data);\n          }\n        } else {\n          wait(25);\n        }\n      }, delay);\n    };\n\n    const wait = (delay) => {\n      if (promises.length) {\n        Promise.all(promises).then(() => {\n          subWait(delay);\n          promises = [];\n        }).catch((error) => {\n          Meteor._debug('[ostrio:flow-router-extra] [route.wait] Promise not resolved', error);\n        });\n      } else {\n        subWait(delay);\n      }\n    };\n\n    const processSubData = (subData) => {\n      if (subData instanceof Array) {\n        for (let i = subData.length - 1; i >= 0; i--) {\n          if (subData[i] !== null && typeof subData[i] === 'object') {\n            placeIn(subData[i]);\n          }\n        }\n      } else if (subData !== null && typeof subData === 'object') {\n        placeIn(subData);\n      }\n    };\n\n    const stopSubs = () => {\n      for (let i = subscriptions.length - 1; i >= 0; i--) {\n        if (subscriptions[i].stop) {\n          subscriptions[i].stop();\n        }\n        delete subscriptions[i];\n      }\n      subscriptions = [];\n    };\n\n    const done = (subscription) => {\n      processSubData(_helpers.isFunction(subscription) ? subscription() : subscription);\n    };\n\n    if (current.route.globals.length) {\n      for (let i = 0; i < current.route.globals.length; i++) {\n        if (typeof current.route.globals[i] === 'object') {\n          if (current.route.globals[i].waitOnResources) {\n            if (!_resources) { _resources = []; }\n            _resources.push(current.route.globals[i].waitOnResources);\n          }\n\n          if (current.route.globals[i].waitOn && _helpers.isFunction(current.route.globals[i].waitOn)) {\n            waitFor.unshift(current.route.globals[i].waitOn);\n          }\n        }\n      }\n    }\n\n    if (this._waitOnResources) {\n      if (!_resources) { _resources = []; }\n      _resources.push(this._waitOnResources);\n    }\n\n    const preload = (len, __data) => {\n      _preloaded++;\n      if (_preloaded >= len) {\n        next(current, __data);\n      }\n    };\n\n    const getData = () => {\n      if (this._data) {\n        if (!_data) {\n          _data = this._currentData = this._data(current.params, current.queryParams);\n        } else {\n          _data = this._currentData;\n        }\n      }\n      return _data;\n    };\n\n    const getResources = () => {\n      _data      = getData();\n      let len    = 0;\n      let items;\n      let images = [];\n      let other  = [];\n      for (let i = _resources.length - 1; i >= 0; i--) {\n        items = _resources[i].call(this, current.params, current.queryParams, _data);\n        if (items) {\n          if (items.images && items.images.length) {\n            images = images.concat(items.images);\n          }\n          if (items.other && items.other.length) {\n            other = other.concat(items.other);\n          }\n        }\n      }\n\n      if ((other && other.length) || (images && images.length)) {\n        if (other && other.length && typeof XMLHttpRequest !== 'undefined') {\n          other = other.filter((elem, index, self) => {\n            return index === self.indexOf(elem);\n          });\n          len += other.length;\n          const prefetch = {};\n          for (let k = other.length - 1; k >= 0; k--) {\n            prefetch[k] = new XMLHttpRequest();\n            prefetch[k].onload  = () => { preload(len, _data); };\n            prefetch[k].onerror = () => { preload(len, _data); };\n            prefetch[k].open('GET', other[k]);\n            prefetch[k].send(null);\n          }\n        }\n\n        if (images && images.length){\n          images = images.filter((elem, index, self) => {\n            return index === self.indexOf(elem);\n          });\n          len += images.length;\n          const imgs = {};\n          for (let j = images.length - 1; j >= 0; j--) {\n            imgs[j]         = new Image();\n            imgs[j].onload  = () => { preload(len, _data); };\n            imgs[j].onerror = () => { preload(len, _data); };\n            imgs[j].src     = images[j];\n          }\n        }\n      } else {\n        next(current, _data);\n      }\n    };\n\n    if (this._waitFor.length) {\n      waitFor = waitFor.concat(this._waitFor);\n    }\n\n    if (_helpers.isFunction(this._waitOn)) {\n      waitFor.push(this._waitOn);\n    }\n\n    if (waitFor.length) {\n      waitFor.forEach((wo) => {\n        processSubData(wo.call(this, current.params, current.queryParams, done));\n      });\n\n      let triggerExitIndex = this._triggersExit.push(() => {\n        stopSubs();\n        for (let i = trackers.length - 1; i >= 0; i--) {\n          if (trackers[i].stop) {\n            trackers[i].stop();\n          }\n          delete trackers[i];\n        }\n        trackers = [];\n        promises = [];\n        subscriptions = [];\n        _data = this._currentData = null;\n        this._triggersExit.splice(triggerExitIndex - 1, 1);\n      });\n\n      whileWaitingAction();\n      wait(0);\n    } else if (_resources) {\n      whileWaitingAction();\n      getResources();\n    } else if (this._data) {\n      next(current, getData());\n    } else {\n      next(current);\n    }\n  }\n\n  callAction(current) {\n    if (this._data) {\n      if (this._onNoData && !this._currentData) {\n        this._endWaiting && this._endWaiting();\n        this._onNoData(current.params, current.queryParams);\n      } else {\n        this._endWaiting && this._endWaiting();\n        this._action(current.params, current.queryParams, this._currentData);\n      }\n    } else {\n      this._endWaiting && this._endWaiting();\n      this._action(current.params, current.queryParams, this._currentData);\n    }\n  }\n\n  callSubscriptions(current) {\n    this.clearSubscriptions();\n    if (this.group) {\n      this.group.callSubscriptions(current);\n    }\n\n    this._subscriptions(current.params, current.queryParams);\n  }\n\n  getRouteName() {\n    this._routeCloseDep.depend();\n    return this.name;\n  }\n\n  getParam(key) {\n    this._routeCloseDep.depend();\n    return this._params.get(key);\n  }\n\n  getQueryParam(key) {\n    this._routeCloseDep.depend();\n    return this._queryParams.get(key);\n  }\n\n  watchPathChange() {\n    this._pathChangeDep.depend();\n  }\n\n  registerRouteClose() {\n    this._params = new ReactiveDict();\n    this._queryParams = new ReactiveDict();\n    this._routeCloseDep.changed();\n    this._pathChangeDep.changed();\n  }\n\n  registerRouteChange(currentContext, routeChanging) {\n    // register params\n    this._updateReactiveDict(this._params, currentContext.params);\n\n    // register query params\n    this._updateReactiveDict(this._queryParams, currentContext.queryParams);\n\n    // if the route is changing, we need to defer triggering path changing\n    // if we did this, old route's path watchers will detect this\n    // Real issue is, above watcher will get removed with the new route\n    // So, we don't need to trigger it now\n    // We are doing it on the route close event. So, if they exists they'll\n    // get notify that\n    if(!routeChanging) {\n      this._pathChangeDep.changed();\n    }\n  }\n\n  _updateReactiveDict(dict, newValues) {\n    const currentKeys = Object.keys(newValues);\n    const oldKeys = Object.keys(dict.keyDeps);\n\n    // set new values\n    //  params is an array. So, currentKeys.forEach() does not works\n    //  to iterate params\n    currentKeys.forEach((key) => {\n      dict.set(key, newValues[key]);\n    });\n\n    // remove keys which does not exisits here\n    oldKeys.filter((i) => {\n      return currentKeys.indexOf(i) < 0;\n    }).forEach((key) => {\n      dict.set(key, undefined);\n    });\n  }\n}\n\nexport default Route;\n"]},"sourceType":"script","hash":"65d67bbca41757b378c701c98a9dbfd2ad2bb8c5"}
