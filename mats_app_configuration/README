METexpress operations.
METexpress is a tool suite of applications that run under Docker.
For questions or bugs you can use the "contact" link in the header at the top of the landing page or
if you have NOAA credentials you can use the "MATS bugs/issues" link at the top of each application.
Failing that contact Randy Pierce at randy.pierce@noaa.gov 

Retrieve the Code:
From VLAB....
git clone gerrit:MATS_for_EMB 
In the top level of the MATS_for_EMB directory structure copy the mats_app_configuration directory tree.
Put your copy of mats_app_configuration in the $HOME of the docker user. 
Create an empty data directory for the mongo container $HOME/mongodata and make sure that the docker user can read and write the directory. 

NOTE: 
You need to modify the mats_app_configuration/settings/*/settings.json files 
and change the some_db_host, some_db_port, some_db_user, and some_db_password entries to conform to the database on your system. 
These ones in vlab are dummy values. Normally these files are all the same, but they might change under special circumstances.

NOTE:
App images are currently kept in a public dockerHub registry at https://hub.docker.com/search/?q=randytpierce%2Fmats1&type=image
This registry WILL CHANGE IN THE NEAR FUTURE.

The applist.json is currently configured for three apps. When additional apps are added you will need to add "app" blocks to the applist.json
and corresponding service blocks to the docker-compose.yaml file.
You can edit the applist.json file and the docker-compose.yml while the service is running and then perform "docker-compose restart"
from the mats_app_configuration directory. New apps will be automatically picked up.

To add an app:
1) modify the mats_app_configuration/docker-compose.yaml to include a new appblock changing met-fred to the name of the new app.
like...
 met-fred:
   container_name: "met-fred"
   image: randytpierce/mats1:met-fred-dev-2.1.4
   environment:
     - DELAY=3
   links:
    - mongo
   volumes:
    - $HOME/mats_app_configuration/settings:/usr/app/settings
   depends_on:
    - mongo
   restart: always
   labels:
    - traefik.backend=met-fred
    - traefik.frontend.rule=Host:met-fred.localhost
    - traefik.docker.network=web
    - traefik.port=80
   networks:
    - web
    - internal
....

2) modify the mats_app_configuration/web/applist.json to include a new app changing met-fred to the new app name to match the docker-compose.yml changes.
like...
{
  "app": "met-fred",
  "displayName": "MET Fred"
  "group": "MET Express"
}
...

3) add a settings file to $HOME/mats_app_configuration/settings/met-fred/settings.json to set the database credentials
for the new app.

4) perform "docker-compose restart" in the metexpress_app_configuration directory.

Using docker-compose:
The command "docker-compose up -d" will start the entire application suite in detached mode. 
After approximately 3 seconds the applications will be available through the landing page.
The landing page is https://dockerhost
Access the apps through the landing page buttons or https://dockerhost/app  like https://dockerhost/met-anomalycor
 
Restarting after changes...
Use the command "docker-compose restart" from the mats_app_configuration directory.

Debugging startup problems:
You can start the tool suite in interactive mode by leaving off the "-d". i.e. "docker-compose up"
When starting this way the output information from Docker will be printed to standard out.



